import{c as O,W,b as p,e as c,f as e,h as T,X as B,n as A,j as v,t as P,k as X,C as L,D as J,g as V,r as C,S as Q,o as Y,z as G,$ as ee,A as q,i as w,M as j,N as te,d as ye,m as ge,T as ve,w as U,p as xe,V as be,_ as oe,a as he}from"./index-jy5-nOjD.js";const we={key:0,class:"folder-children"},ke={__name:"FolderTreeItem",props:{folder:{type:Object,required:!0},level:{type:Number,default:0},currentPath:{type:String,default:""},expandedFolders:{type:Array,default:()=>[]}},emits:["select","toggle"],setup(o,{emit:k}){const f=o,g=k,r=O(()=>f.folder.path.replace(/\\/g,"/")),a=O(()=>{const $=r.value;return f.expandedFolders.some(m=>(typeof m=="string"?m.replace(/\\/g,"/"):"")===$)}),n=O(()=>f.folder.children&&f.folder.children.length>0),x=O(()=>{if(!f.currentPath)return!1;const $=f.currentPath.replace(/\\/g,"/"),m=f.folder.path.replace(/\\/g,"/");return $===m}),y=O(()=>n.value&&a.value?"folder-open":"folder"),M=O(()=>n.value?a.value?"text-yellow-500":"text-blue-500":"text-gray-400");function i(){g("select",f.folder.path)}function b($){$&&$.stopPropagation(),n.value&&g("toggle",f.folder.path)}return($,m)=>{const F=W("FontAwesomeIcon"),D=W("FolderTreeItem",!0);return c(),p(L,null,[e("div",{class:A(["folder-item flex items-center p-2 cursor-pointer rounded transition-colors",{"bg-primary/10 border border-primary/20":x.value,"hover:bg-background-soft":!x.value,"font-medium":n.value,"font-normal":!n.value}]),style:X({paddingLeft:`${o.level*16}px`}),onClick:i},[e("span",{class:A(["expand-icon w-6 text-center mr-2",{"cursor-pointer":n.value,"cursor-default opacity-50":!n.value}]),onClick:m[0]||(m[0]=B(s=>n.value?b(s):null,["stop"]))},[v(F,{icon:y.value,class:A(M.value)},null,8,["icon","class"])],2),e("span",{class:A({"text-text-muted":!n.value})},P(o.folder.name),3)],6),a.value&&n.value?(c(),p("div",we,[(c(!0),p(L,null,J(o.folder.children,s=>(c(),V(D,{key:s.path,folder:s,level:o.level+1,"current-path":o.currentPath,"expanded-folders":o.expandedFolders,onSelect:m[1]||(m[1]=t=>$.$emit("select",t)),onToggle:m[2]||(m[2]=t=>$.$emit("toggle",t))},null,8,["folder","level","current-path","expanded-folders"]))),128))])):T("",!0)],64)}}},$e={class:"folder-tree h-full overflow-y-auto"},Fe={key:0,class:"ml-4"},Ce={key:1,class:"text-center py-4"},De={__name:"FolderTreeComponent",props:{folders:{type:Array,default:()=>[]},currentPath:{type:String,default:""}},emits:["select-folder"],setup(o,{emit:k}){const f=o,g=k,r=C(!0),a=C(JSON.parse(localStorage.getItem("comfyui-expanded-folders")||"[]"));function n(){localStorage.setItem("comfyui-expanded-folders",JSON.stringify(a.value))}function x(i){if(!i)return;const $=i.replace(/\\/g,"/").split("/").filter(Boolean);let m="",F=!1;for(const D of $)m?m+="/"+D:m=D,a.value.some(t=>t.replace(/\\/g,"/")===m)||(a.value.push(m),F=!0);F&&n()}function y(i){const b=i.replace(/\\/g,"/");x(b),g("select-folder",i)}function M(i,b=!1){const $=i.replace(/\\/g,"/"),m=a.value.findIndex(F=>F.replace(/\\/g,"/")===$);b&&m===-1?(a.value.push($),n()):b||(m===-1?(a.value.push($),n()):(a.value.splice(m,1),n()))}return Q(()=>f.currentPath,i=>{i===""?r.value=!0:i&&x(i)},{immediate:!0}),Y(()=>{f.currentPath&&x(f.currentPath)}),(i,b)=>{const $=W("FontAwesomeIcon");return c(),p("div",$e,[e("div",{class:A(["folder-item flex items-center p-2 cursor-pointer rounded transition-colors",{"bg-primary/10 border border-primary/20":!o.currentPath,"hover:bg-background-soft":o.currentPath}]),onClick:b[1]||(b[1]=m=>y(""))},[e("span",{class:"expand-icon w-6 text-center mr-2 cursor-pointer",onClick:b[0]||(b[0]=B(m=>r.value=!r.value,["stop"]))},[v($,{icon:r.value?"folder-open":"folder",class:A(r.value?"text-yellow-500":"text-blue-500")},null,8,["icon","class"])]),b[2]||(b[2]=e("span",{class:"font-medium"},"/ (root)",-1))],2),r.value&&o.folders.length>0?(c(),p("div",Fe,[(c(!0),p(L,null,J(o.folders,m=>(c(),V(ke,{key:m.path,folder:m,level:1,"current-path":o.currentPath,"expanded-folders":a.value,onSelect:y,onToggle:M},null,8,["folder","current-path","expanded-folders"]))),128))])):T("",!0),!o.folders||o.folders.length===0?(c(),p("div",Ce,b[3]||(b[3]=[e("small",{class:"text-text-muted"},"No folders found",-1)]))):T("",!0)])}}},Pe=["value"],Se={class:"flex"},Te=["value"],Ue={class:"flex items-center"},Me={key:0,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"},Ie={class:"flex justify-end space-x-3 pt-4"},Ae=["disabled"],Ne={key:0,class:"inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},je={__name:"ModelFormComponent",props:{formData:{type:Object,required:!0},groups:{type:Array,default:()=>[]},isSubmitting:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["submit","cancel","update:formData"],setup(o,{emit:k}){const f=o,g=k,r=C(""),a=C(""),n=C(""),x=C(""),y=C(["checkpoint","lora","lycoris","hypernetwork","textual-inversion","upscaler","vae","controlnet","other"]);Y(()=>{var D,s,t,u,z,N,_;(t=(s=(D=f.formData)==null?void 0:D.entry)==null?void 0:s.tags)!=null&&t.length&&(Array.isArray(f.formData.entry.tags)?r.value=f.formData.entry.tags.join(", "):r.value=f.formData.entry.tags),(z=(u=f.formData)==null?void 0:u.entry)!=null&&z.type&&(y.value.includes(f.formData.entry.type)?a.value=f.formData.entry.type:f.formData.entry.type&&(a.value="custom",n.value=f.formData.entry.type)),(_=(N=f.formData)==null?void 0:N.entry)!=null&&_.dest&&(x.value=f.formData.entry.dest.replace(/^\$\{BASE_DIR\}\//,""))});const M=()=>{a.value==="custom"?F("type",n.value):F("type",a.value)},i=()=>{F("type",n.value)},b=()=>{const D=x.value?`\${BASE_DIR}/${x.value}`:"";F("dest",D)},$=()=>{g("submit")},m=()=>{g("cancel")};Q(r,D=>{if(!D){F("tags",[]);return}const s=D.split(",").map(t=>t.trim()).filter(t=>t.length>0);F("tags",s)});const F=(D,s)=>{const t={...f.formData};t.entry||(t.entry={}),t.entry={...t.entry,[D]:s},g("update:formData",t)};return(D,s)=>(c(),p("form",{onSubmit:B($,["prevent"]),class:"space-y-4"},[e("div",null,[s[8]||(s[8]=e("label",{for:"group",class:"block text-sm font-medium text-text-light mb-1"},"Group",-1)),G(e("select",{id:"group","onUpdate:modelValue":s[0]||(s[0]=t=>o.formData.group=t),class:"form-select w-full",required:""},[s[7]||(s[7]=e("option",{value:"",disabled:""},"Select a group",-1)),(c(!0),p(L,null,J(o.groups,t=>(c(),p("option",{key:t,value:t},P(t),9,Pe))),128))],512),[[ee,o.formData.group]])]),e("div",null,[s[11]||(s[11]=e("label",{for:"type",class:"block text-sm font-medium text-text-light mb-1"},"Model Type",-1)),e("div",Se,[G(e("select",{id:"type","onUpdate:modelValue":s[1]||(s[1]=t=>a.value=t),class:A(["form-select flex-1",{"rounded-r-none":a.value==="custom"}]),onChange:M},[s[9]||(s[9]=e("option",{value:""},"-- Select Type (optional) --",-1)),(c(!0),p(L,null,J(y.value,t=>(c(),p("option",{key:t,value:t},P(t),9,Te))),128)),s[10]||(s[10]=e("option",{value:"custom"},"Custom type...",-1))],34),[[ee,a.value]]),a.value==="custom"?G((c(),p("input",{key:0,type:"text","onUpdate:modelValue":s[2]||(s[2]=t=>n.value=t),class:"form-input flex-1 rounded-l-none border-l-0",placeholder:"Enter custom type",onInput:i},null,544)),[[q,n.value]]):T("",!0)]),s[12]||(s[12]=e("p",{class:"text-sm text-text-muted mt-1"},"Type of model (e.g., checkpoint, lora, textual inversion)",-1))]),e("div",null,[s[13]||(s[13]=e("label",{for:"url",class:"block text-sm font-medium text-text-light mb-1"},"Download URL",-1)),G(e("input",{type:"url",class:"form-input w-full",id:"url","onUpdate:modelValue":s[3]||(s[3]=t=>o.formData.entry.url=t),required:""},null,512),[[q,o.formData.entry.url]]),s[14]||(s[14]=e("p",{class:"text-sm text-text-muted mt-1"},"Direct download link for the model",-1))]),e("div",null,[s[15]||(s[15]=e("label",{for:"src",class:"block text-sm font-medium text-text-light mb-1"},"Source Page",-1)),G(e("input",{type:"url",class:"form-input w-full",id:"src","onUpdate:modelValue":s[4]||(s[4]=t=>o.formData.entry.src=t)},null,512),[[q,o.formData.entry.src]]),s[16]||(s[16]=e("p",{class:"text-sm text-text-muted mt-1"},"Reference page where the model was found",-1))]),e("div",null,[s[17]||(s[17]=e("label",{for:"tags",class:"block text-sm font-medium text-text-light mb-1"},"Tags (comma separated)",-1)),G(e("input",{type:"text",class:"form-input w-full",id:"tags","onUpdate:modelValue":s[5]||(s[5]=t=>r.value=t)},null,512),[[q,r.value]]),s[18]||(s[18]=e("p",{class:"text-sm text-text-muted mt-1"},"e.g. stable-diffusion, lora, inpainting",-1))]),e("div",null,[s[20]||(s[20]=e("label",{for:"dest",class:"block text-sm font-medium text-text-light mb-1"},"Destination Path",-1)),e("div",Ue,[s[19]||(s[19]=e("span",{class:"bg-background-mute text-text-muted px-3 py-2 rounded-l border border-r-0 border-border text-sm"}," ${BASE_DIR}/ ",-1)),G(e("input",{type:"text",id:"dest",class:"form-input flex-1 rounded-l-none border-l-0","onUpdate:modelValue":s[6]||(s[6]=t=>x.value=t),onInput:b,placeholder:"category/model.safetensors"},null,544),[[q,x.value]])]),s[21]||(s[21]=e("p",{class:"text-sm text-text-muted mt-1"},"Path relative to the base directory where the model will be stored.",-1))]),o.error?(c(),p("div",Me,P(o.error),1)):T("",!0),e("div",Ie,[e("button",{type:"button",class:"btn btn-secondary",onClick:m},s[22]||(s[22]=[e("i",{class:"fas fa-times mr-1"},null,-1),w(" Cancel ")])),e("button",{type:"submit",class:"btn btn-primary",disabled:o.isSubmitting},[o.isSubmitting?(c(),p("span",Ne)):T("",!0),e("i",{class:A(["fas",o.formData.entry.dest||o.formData.entry.git?"fa-save":"fa-plus"])},null,2),w(" "+P(o.formData.entry.dest||o.formData.entry.git?" Update":" Add"),1)],8,Ae)])],32))}},ze={key:0,class:"bg-background-soft rounded-lg border border-border overflow-hidden"},Ee={class:"w-full"},Re={class:"divide-y divide-border"},Be={class:"hover:bg-background"},Oe={class:"px-4 py-3"},Ve={class:"hover:bg-background"},Le={class:"px-4 py-3 font-mono text-sm"},Ge={class:"hover:bg-background"},_e={class:"px-4 py-3"},Je={class:"hover:bg-background"},qe={class:"px-4 py-3"},We={class:"hover:bg-background"},He={class:"px-4 py-3"},Ke={class:"hover:bg-background"},Xe={class:"px-4 py-3"},Qe={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Ye={key:1,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800"},Ze={key:0,class:"hover:bg-background"},et={class:"px-4 py-3"},tt=["href"],ot={key:1,class:"hover:bg-background"},lt={class:"px-4 py-3"},st={class:"bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded"},rt={class:"mt-2 text-sm"},nt={key:2,class:"hover:bg-background"},at={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},it={class:"relative bg-background rounded-lg border border-border shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},dt={class:"p-6"},ut={__name:"FilePropertiesComponent",props:{fileProps:Object,selectedFile:Object},setup(o){const k=o,{success:f,error:g}=te(),r=C(!1),a=C(!1),n=C(""),x=C([]),y=C({group:"",entry:{url:"",dest:"",src:"",type:"",tags:[],size:0}}),M=O(()=>!k.fileProps||!k.fileProps.is_file||!k.fileProps.name.toLowerCase().endsWith(".safetensors")?!1:!(k.selectedFile&&k.selectedFile.is_registered));function i(t){return typeof t!="number"?t:t>=1e9?(t/1e9).toFixed(2)+" GB":t>=1e6?(t/1e6).toFixed(2)+" MB":t>=1e3?(t/1e3).toFixed(2)+" KB":t+" B"}function b(t){return t?new Date(t).toLocaleString():""}function $(t){if(!t)return"";try{const u=new URL(t);return u.hostname.includes("civitai.com")?"Civitai":u.hostname.includes("huggingface.co")?"Hugging Face":u.hostname.includes("github.com")?"GitHub":u.hostname}catch{return t.length>30?t.substring(0,27)+"...":t}}const m=async()=>{try{const t=await j.get("/jsonmodels/groups");x.value=t.data}catch(t){console.error("Error fetching model groups:",t),n.value="Failed to load model groups. Please try again."}},F=async()=>{n.value="",y.value={group:"",entry:{url:"",dest:k.fileProps.path,src:"",type:"",tags:[],size:k.fileProps.size}};const t=k.fileProps.path.toLowerCase();t.includes("/lora/")?y.value.entry.type="lora":t.includes("/lycoris/")?y.value.entry.type="lycoris":t.includes("/vae/")?y.value.entry.type="vae":t.includes("/embeddings/")||t.includes("/textual_inversion/")?y.value.entry.type="textual-inversion":t.includes("/checkpoint/")||t.includes("/model/")?y.value.entry.type="checkpoint":t.includes("/controlnet/")?y.value.entry.type="controlnet":t.includes("/upscaler/")?y.value.entry.type="upscaler":t.includes("/hypernetwork/")&&(y.value.entry.type="hypernetwork"),await m(),r.value=!0},D=()=>{r.value=!1},s=async()=>{var t,u;a.value=!0,n.value="";try{const z=await j.post("/jsonmodels/entry",y.value);D(),f("Model successfully added to models.json",5e3,!0);const N=new CustomEvent("models-json-updated");document.dispatchEvent(N)}catch(z){console.error("Error adding model to models.json:",z);const N=((u=(t=z.response)==null?void 0:t.data)==null?void 0:u.detail)||"Failed to add model. Please try again.";n.value=N,g(`Failed to add model: ${N}`,8e3,!0)}finally{a.value=!1}};return(t,u)=>(c(),p(L,null,[o.fileProps?(c(),p("div",ze,[e("table",Ee,[e("tbody",Re,[e("tr",Be,[u[1]||(u[1]=e("td",{class:"px-4 py-3 font-medium text-text-light"},[e("i",{class:"fas fa-file mr-2"}),w(" Name ")],-1)),e("td",Oe,P(o.fileProps.name),1)]),e("tr",Ve,[u[2]||(u[2]=e("td",{class:"px-4 py-3 font-medium text-text-light"},[e("i",{class:"fas fa-folder mr-2"}),w(" Path ")],-1)),e("td",Le,P(o.fileProps.path),1)]),e("tr",Ge,[u[3]||(u[3]=e("td",{class:"px-4 py-3 font-medium text-text-light"},[e("i",{class:"fas fa-weight-hanging mr-2"}),w(" Size ")],-1)),e("td",_e,P(i(o.fileProps.size)),1)]),e("tr",Je,[u[4]||(u[4]=e("td",{class:"px-4 py-3 font-medium text-text-light"},[e("i",{class:"fas fa-calendar-plus mr-2"}),w(" Created ")],-1)),e("td",qe,P(b(o.fileProps.created)),1)]),e("tr",We,[u[5]||(u[5]=e("td",{class:"px-4 py-3 font-medium text-text-light"},[e("i",{class:"fas fa-calendar-check mr-2"}),w(" Modified ")],-1)),e("td",He,P(b(o.fileProps.modified)),1)]),e("tr",Ke,[u[6]||(u[6]=e("td",{class:"px-4 py-3 font-medium text-text-light"},[e("i",{class:"fas fa-tag mr-2"}),w(" Type ")],-1)),e("td",Xe,[o.fileProps.is_dir?(c(),p("span",Qe," Directory ")):o.fileProps.is_file?(c(),p("span",Ye," File ")):T("",!0)])]),o.selectedFile&&o.selectedFile.source_url?(c(),p("tr",Ze,[u[8]||(u[8]=e("td",{class:"px-4 py-3 font-medium text-text-light"},[e("i",{class:"fas fa-link mr-2"}),w(" Source ")],-1)),e("td",et,[e("a",{href:o.selectedFile.source_url,target:"_blank",rel:"noopener noreferrer",class:"text-primary hover:text-primary/80 inline-flex items-center",title:"Open this link in a new tab"},[w(P($(o.selectedFile.source_url))+" ",1),u[7]||(u[7]=e("i",{class:"fas fa-external-link-alt ml-1 text-xs"},null,-1))],8,tt)])])):T("",!0),o.selectedFile&&o.selectedFile.is_corrupted?(c(),p("tr",ot,[u[13]||(u[13]=e("td",{class:"px-4 py-3 font-medium text-text-light"},[e("i",{class:"fas fa-exclamation-triangle mr-2"}),w(" Corruption Info ")],-1)),e("td",lt,[e("div",st,[u[11]||(u[11]=e("strong",null,"Warning:",-1)),u[12]||(u[12]=w(" This file may be corrupted. The file size does not match what is expected in models.json. ")),e("div",rt,[e("div",null,[u[9]||(u[9]=e("strong",null,"Expected size:",-1)),w(" "+P(i(o.selectedFile.expected_size)),1)]),e("div",null,[u[10]||(u[10]=e("strong",null,"Actual size:",-1)),w(" "+P(i(o.selectedFile.actual_size)),1)])])])])])):T("",!0),M.value?(c(),p("tr",nt,[u[15]||(u[15]=e("td",{class:"px-4 py-3 font-medium text-text-light"},[e("i",{class:"fas fa-plus-circle mr-2"}),w(" Actions ")],-1)),e("td",{class:"px-4 py-3"},[e("button",{onClick:F,class:"btn btn-sm btn-primary",title:"Add this model to models.json"},u[14]||(u[14]=[e("i",{class:"fas fa-file-import mr-1"},null,-1),w(" Add to models.json ")]))])])):T("",!0)])])])):T("",!0),r.value?(c(),p("div",at,[e("div",{class:"absolute inset-0 bg-black bg-opacity-50",onClick:D}),e("div",it,[e("div",{class:"p-6 border-b border-border"},[u[17]||(u[17]=e("h4",{class:"text-lg font-semibold flex items-center"},[e("i",{class:"fas fa-plus mr-2"}),w(" Add Model to models.json ")],-1)),e("button",{type:"button",class:"absolute top-4 right-4 text-text-muted hover:text-text-light",onClick:D},u[16]||(u[16]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",dt,[v(je,{formData:y.value,"onUpdate:formData":u[0]||(u[0]=z=>y.value=z),groups:x.value,"is-submitting":a.value,error:n.value,onSubmit:s,onCancel:D},null,8,["formData","groups","is-submitting","error"])])])])):T("",!0)],64))}},ct=ye({__name:"TooltipComponent",props:{text:{},position:{default:"top"},delay:{default:500}},setup(o){const k=o,f=C(!1),g=C(),r=C({});let a=null;const n=O(()=>{switch(k.position){case"top":return"top-full left-1/2 transform -translate-x-1/2 -mt-1";case"bottom":return"bottom-full left-1/2 transform -translate-x-1/2 -mb-1";case"left":return"left-full top-1/2 transform -translate-y-1/2 -ml-1";case"right":return"right-full top-1/2 transform -translate-y-1/2 -mr-1";default:return"top-full left-1/2 transform -translate-x-1/2 -mt-1"}});function x(){if(!g.value)return;const i=g.value.getBoundingClientRect(),b=8;switch(k.position){case"top":r.value={left:`${i.left+i.width/2}px`,top:`${i.top-b}px`,transform:"translate(-50%, -100%)"};break;case"bottom":r.value={left:`${i.left+i.width/2}px`,top:`${i.bottom+b}px`,transform:"translate(-50%, 0)"};break;case"left":r.value={left:`${i.left-b}px`,top:`${i.top+i.height/2}px`,transform:"translate(-100%, -50%)"};break;case"right":r.value={left:`${i.right+b}px`,top:`${i.top+i.height/2}px`,transform:"translate(0, -50%)"};break;default:r.value={left:`${i.left+i.width/2}px`,top:`${i.top-b}px`,transform:"translate(-50%, -100%)"}}}function y(){a=window.setTimeout(async()=>{f.value=!0,await be(),x()},k.delay)}function M(){a&&(window.clearTimeout(a),a=null),f.value=!1}return(i,b)=>(c(),p("div",{class:"relative inline-block",onMouseenter:y,onMouseleave:M,ref_key:"triggerRef",ref:g},[ge(i.$slots,"default",{},void 0,!0),(c(),V(xe,{to:"body"},[v(ve,{name:"tooltip-fade",appear:""},{default:U(()=>[f.value?(c(),p("div",{key:0,class:A(["fixed z-[9999] px-3 py-2 text-sm text-white bg-gray-900 rounded-lg shadow-xl","border border-gray-700 backdrop-blur-sm","pointer-events-none whitespace-nowrap"]),style:X(r.value)},[w(P(i.text)+" ",1),e("div",{class:A(["absolute w-2 h-2 bg-gray-900 border-l border-b border-gray-700 transform rotate-45",n.value])},null,2)],4)):T("",!0)]),_:1})]))],544))}}),I=oe(ct,[["__scopeId","data-v-870edeac"]]),ft={class:"directory-details flex flex-col h-full"},mt={class:"toolbar-container flex items-center mb-4 p-4 bg-background-soft rounded-lg"},pt={class:"mr-4"},yt={class:"bg-background px-2 py-1 rounded text-sm"},gt=["disabled"],vt={class:"ml-auto flex space-x-2"},xt={for:"fileUpload",class:"inline-flex items-center px-3 py-1.5 text-sm bg-green-600 text-white rounded hover:bg-green-700 transition-colors cursor-pointer"},bt={class:"details-container flex-1 overflow-auto space-y-6"},ht={class:"subdirectory-list-container"},wt={class:"bg-background-soft rounded-lg border border-border overflow-hidden"},kt=["onMouseover","onDblclick"],$t={class:"flex items-center"},Ft=["onClick"],Ct=["onClick"],Dt=["onClick"],Pt={key:0,class:"text-text-muted text-center py-6"},St={class:"file-list-container"},Tt={class:"bg-background-soft rounded-lg border border-border overflow-hidden"},Ut=["onClick"],Mt={class:"flex items-center min-w-0 flex-1"},It={class:"flex items-center min-w-0"},At={class:"truncate"},Nt={class:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"},jt={class:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800"},zt={class:"file-actions flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity"},Et=["onClick"],Rt=["onClick"],Bt=["onClick"],Ot=["onClick"],Vt={key:0,class:"text-text-muted text-center py-6"},Lt={class:"file-properties-container"},Gt={class:"text-lg font-medium mb-3 flex items-center"},_t={key:1,class:"text-text-muted bg-background-soft p-6 rounded-lg text-center"},Jt={__name:"DirectoryDetailsComponent",props:{currentPath:String,files:Array,dirs:Array,selectedFile:Object,fileProps:Object},emits:["go-up","refresh","file-upload","create-directory","navigate-to-folder","select-file","rename","delete","download","copy"],setup(o,{emit:k}){const f=C(null);return(g,r)=>{const a=W("FontAwesomeIcon");return c(),p("div",ft,[e("div",mt,[e("span",pt,[r[5]||(r[5]=e("strong",null,"Current:",-1)),e("code",yt,P(o.currentPath||"/"),1)]),v(I,{text:"Go to parent directory",delay:300},{default:U(()=>[e("button",{class:"px-3 py-1.5 text-sm bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors mr-2",onClick:r[0]||(r[0]=n=>g.$emit("go-up")),disabled:!o.currentPath},[v(a,{icon:"arrow-up",class:"mr-1"}),r[6]||(r[6]=w(" Up "))],8,gt)]),_:1}),v(I,{text:"Refresh current directory",delay:300},{default:U(()=>[e("button",{class:"px-3 py-1.5 text-sm bg-transparent border border-gray-500 text-gray-300 rounded hover:bg-gray-600 hover:text-white transition-colors mr-2",onClick:r[1]||(r[1]=n=>g.$emit("refresh"))},[v(a,{icon:"sync",class:"mr-1"}),r[7]||(r[7]=w(" Refresh "))])]),_:1}),e("div",vt,[v(I,{text:"Upload files to this directory",delay:300},{default:U(()=>[e("label",xt,[v(a,{icon:"upload",class:"mr-1"}),r[8]||(r[8]=w(" Upload ")),e("input",{type:"file",id:"fileUpload",class:"hidden",onChange:r[2]||(r[2]=n=>g.$emit("file-upload",n)),multiple:"",accept:".safetensors,.ckpt,.pt,.pth,.bin"},null,32)])]),_:1}),v(I,{text:"Create a new folder",delay:300},{default:U(()=>[e("button",{class:"px-3 py-1.5 text-sm bg-transparent border border-gray-500 text-gray-300 rounded hover:bg-gray-600 hover:text-white transition-colors",onClick:r[3]||(r[3]=n=>g.$emit("create-directory"))},[v(a,{icon:"folder-plus",class:"mr-1"}),r[9]||(r[9]=w(" New Folder "))])]),_:1})])]),e("div",bt,[e("div",ht,[r[11]||(r[11]=e("h5",{class:"text-lg font-medium mb-3"},"Subdirectories",-1)),e("div",wt,[(c(!0),p(L,null,J(o.dirs,n=>(c(),p("div",{key:n.path,class:A(["subdirectory-item flex justify-between items-center p-3 border-b border-border last:border-b-0 hover:bg-background transition-colors cursor-pointer group",{"bg-primary/10":o.currentPath===n.path}]),onMouseover:x=>f.value=n.path,onMouseleave:r[4]||(r[4]=x=>f.value=null),onDblclick:x=>g.$emit("navigate-to-folder",n.path)},[v(I,{text:"Double-click to open this folder",delay:500},{default:U(()=>[e("div",$t,[v(a,{icon:"folder",class:"text-primary mr-3"}),e("span",null,P(n.name),1)])]),_:2},1024),e("div",{class:A(["subdirectory-actions flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",{"opacity-100":f.value===n.path||o.currentPath===n.path}])},[v(I,{text:"Open this folder",delay:300},{default:U(()=>[e("button",{class:"px-2 py-1 text-xs bg-primary text-white rounded hover:bg-orange-600 transition-colors",onClick:B(x=>g.$emit("navigate-to-folder",n.path),["stop"])},[v(a,{icon:"folder-open"})],8,Ft)]),_:2},1024),v(I,{text:"Rename folder",delay:300},{default:U(()=>[e("button",{class:"px-2 py-1 text-xs bg-yellow-600 text-white rounded hover:bg-yellow-700 transition-colors",onClick:B(x=>g.$emit("rename",n),["stop"])},[v(a,{icon:"pencil"})],8,Ct)]),_:2},1024),v(I,{text:"Delete folder",delay:300},{default:U(()=>[e("button",{class:"px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 transition-colors",onClick:B(x=>g.$emit("delete",n),["stop"])},[v(a,{icon:"trash"})],8,Dt)]),_:2},1024)],2)],42,kt))),128)),!o.dirs||o.dirs.length===0?(c(),p("div",Pt,r[10]||(r[10]=[e("em",null,"No subdirectories in this directory",-1)]))):T("",!0)])]),e("div",St,[r[15]||(r[15]=e("h5",{class:"text-lg font-medium mb-3"},"Files",-1)),e("div",Tt,[(c(!0),p(L,null,J(o.files,n=>(c(),p("div",{key:n.name,class:A(["file-item flex justify-between items-center p-3 border-b border-border last:border-b-0 hover:bg-background transition-colors cursor-pointer group",{"bg-primary/10":o.selectedFile===n,"border-l-4 border-l-green-500":n.is_registered&&!n.is_corrupted,"bg-red-50 border-l-4 border-l-red-500":n.is_corrupted}]),onClick:x=>g.$emit("select-file",n)},[e("div",Mt,[v(I,{text:"Click to select and view file properties",delay:500},{default:U(()=>[e("div",It,[v(a,{icon:"file-lines",class:"text-primary mr-3 flex-shrink-0"}),e("span",At,P(n.name),1)])]),_:2},1024),n.is_registered&&!n.is_corrupted?(c(),V(I,{key:0,text:"This model is registered in models.json and ready to use",delay:300},{default:U(()=>[e("span",Nt,[v(a,{icon:"check-circle",class:"mr-1"}),r[12]||(r[12]=w(" Registered "))])]),_:1})):T("",!0),n.is_corrupted?(c(),V(I,{key:1,text:`This file may be corrupted. Expected: ${g.formatSize(n.expected_size)}, Actual: ${g.formatSize(n.actual_size)}`,delay:300},{default:U(()=>[e("span",jt,[v(a,{icon:"exclamation-triangle",class:"mr-1"}),r[13]||(r[13]=w(" Corrupted "))])]),_:2},1032,["text"])):T("",!0)]),e("div",zt,[v(I,{text:"Download this file",delay:300},{default:U(()=>[e("button",{class:"px-2 py-1 text-xs bg-primary text-white rounded hover:bg-orange-600 transition-colors",onClick:B(x=>g.$emit("download",n),["stop"])},[v(a,{icon:"download"})],8,Et)]),_:2},1024),v(I,{text:"Rename file",delay:300},{default:U(()=>[e("button",{class:"px-2 py-1 text-xs bg-yellow-600 text-white rounded hover:bg-yellow-700 transition-colors",onClick:B(x=>g.$emit("rename",n),["stop"])},[v(a,{icon:"pencil"})],8,Rt)]),_:2},1024),v(I,{text:"Make a copy of this file",delay:300},{default:U(()=>[e("button",{class:"px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",onClick:B(x=>g.$emit("copy",n),["stop"])},[v(a,{icon:"copy"})],8,Bt)]),_:2},1024),v(I,{text:"Delete this file",delay:300},{default:U(()=>[e("button",{class:"px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 transition-colors",onClick:B(x=>g.$emit("delete",n),["stop"])},[v(a,{icon:"trash"})],8,Ot)]),_:2},1024)])],10,Ut))),128)),o.files.length===0?(c(),p("div",Vt,r[14]||(r[14]=[e("em",null,"No files in this directory",-1)]))):T("",!0)])]),e("div",Lt,[e("h5",Gt,[r[18]||(r[18]=w(" File Properties ")),o.selectedFile&&o.selectedFile.is_registered&&!o.selectedFile.is_corrupted?(c(),V(I,{key:0,text:"This file is referenced in models.json and is ready to use with ComfyUI",delay:300},{default:U(()=>r[16]||(r[16]=[e("span",{class:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"}," Registered Model ",-1)])),_:1,__:[16]})):T("",!0),o.selectedFile&&o.selectedFile.is_corrupted?(c(),V(I,{key:1,text:`This file may be corrupted. Expected: ${g.formatSize(o.selectedFile.expected_size)}, Actual: ${g.formatSize(o.selectedFile.actual_size)}`,delay:300},{default:U(()=>r[17]||(r[17]=[e("span",{class:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800"}," Potentially Corrupted ",-1)])),_:1,__:[17]},8,["text"])):T("",!0)]),o.fileProps?(c(),V(ut,{key:0,"file-props":o.fileProps,"selected-file":o.selectedFile},null,8,["file-props","selected-file"])):(c(),p("div",_t," Select a file to see its properties. "))])])])}}},qt={class:"space-y-6 p-4 bg-background"},Wt={key:0,class:"fixed top-0 left-0 right-0 z-50 bg-background border-b border-border shadow-lg"},Ht={class:"px-4 py-3"},Kt={class:"flex items-center justify-between mb-2"},Xt={class:"flex items-center"},Qt={class:"text-sm font-medium text-text-light"},Yt={class:"text-sm text-text-light"},Zt={class:"w-full bg-background-soft rounded-full h-2"},eo={class:"mt-1 text-xs text-text-muted"},to={class:"card"},oo={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mx-4 mt-4"},lo={class:"flex-1 flex overflow-hidden p-4 space-x-4"},so={class:"w-1/3 flex flex-col"},ro={class:"border border-border rounded-lg p-4 h-full flex flex-col"},no={key:0,class:"flex-1 flex items-center justify-center"},ao={key:1,class:"flex-1 overflow-y-auto"},io={class:"w-2/3"},uo={__name:"FileManagerComponent",setup(o){const{success:k,error:f,confirm:g,prompt:r}=te(),a=C(""),n=C([]),x=C([]),y=C(null),M=C(null),i=C(""),b=C([]),$=C(!1),m=C({isUploading:!1,percentage:0,loaded:0,total:0,fileName:""});function F(...l){return l.filter(Boolean).join("/").replace(/\/+/g,"/")}function D(l){if(l===0)return"0 Bytes";const d=1024,h=["Bytes","KB","MB","GB"],S=Math.floor(Math.log(l)/Math.log(d));return parseFloat((l/Math.pow(d,S)).toFixed(2))+" "+h[S]}async function s(){i.value="";try{const l=await j.get(`/file/list_files?path=${encodeURIComponent(a.value)}`);x.value=l.data.files}catch(l){i.value="Failed to list files",console.error("Error fetching files:",l)}}async function t(){i.value="";try{const l=await j.get(`/file/list_dirs?path=${encodeURIComponent(a.value)}`);n.value=Array.isArray(l.data)?l.data.map(d=>({name:d.name,path:d.path,children:d.children||[]})):[]}catch(l){i.value="Failed to list subdirectories",n.value=[],console.error("Error fetching subdirectories:",l)}}async function u(){i.value="";try{const l=await j.get("/file/list_all_dirs");return b.value=Array.isArray(l.data)?l.data.map(d=>({name:d.name,path:d.path,children:d.children||[]})):[],!0}catch(l){return i.value="Failed to fetch directory structure",console.error("Error fetching all directories:",l),!1}}async function z(l){i.value="";const d=F(a.value,l);try{const h=await j.get(`/file/properties?path=${encodeURIComponent(d)}`);M.value=h.data}catch(h){i.value="Failed to get file properties",M.value=null,console.error("Error fetching file properties:",h)}}async function N(){$.value=!1,await u()||(i.value="Failed to load folders. Please try again."),$.value=!0}async function _(){const l=await u();return await s(),await t(),M.value=null,y.value=null,l}function H(l){M.value=null,y.value=null,a.value=l.replace(/\\/g,"/"),s(),t()}function le(){const l=a.value||"";let d="";if(l){const h=l.replace(/\\/g,"/"),S=h.lastIndexOf("/");S>0&&(d=h.substring(0,S))}H(d)}async function se(l){y.value=l;const d=typeof l=="string"?l:l.name;await z(d)}async function re(l){const d=typeof l=="string"?l:l.name,h=await r(`Rename "${d}" to:`,"Rename File/Directory",d);h!==null&&h!==d&&await ie(l,h)}async function ne(l){const d=typeof l=="string"?l:l.name,h=d.includes(".")?d.substring(0,d.lastIndexOf("."))+".copy"+d.substring(d.lastIndexOf(".")):d+".copy",S=await r(`Copy "${d}" to (filename):`,"Copy File/Directory",h);S!==null&&S!==d&&await de(l,S)}async function ae(){const l=await r("Enter the name of the new directory:","Create Directory","New Folder");l!==null&&l.trim()!==""&&await ue(l.trim())&&(await N(),await t(),await s())}async function ie(l,d){const h=typeof l=="string"?l:l.name;i.value="";const S=F(a.value,h),E=F(a.value,d);try{await j.post("/file/rename",{src:S,dst:E}),await _(),k("File renamed successfully")}catch(R){i.value="Failed to rename",f("Failed to rename file"),console.error("Error renaming file:",R)}}async function de(l,d){const h=typeof l=="string"?l:l.name;i.value="";const S=F(a.value,h),E=F(a.value,d);try{await j.post("/file/copy",{src:S,dst:E}),await _(),k("File copied successfully")}catch(R){i.value="Failed to copy",f("Failed to copy file"),console.error("Error copying file:",R)}}async function ue(l){i.value="";const d=F(a.value,l);try{return await j.post("/file/create_dir",{path:d}),await t(),k("Directory created successfully"),!0}catch(h){return i.value="Failed to create directory",f("Failed to create directory"),console.error("Error creating directory:",h),!1}}async function ce(l){const d=typeof l=="string"?l:l.name;if(!await g(`Delete "${d}"?`,"Confirm Deletion"))return;i.value="";const S=F(a.value,d);try{await j.post("/file/delete",{path:S}),await t(),await s(),M.value=null,y.value=null,k("Item deleted successfully"),(typeof l=="string"||l.type==="directory")&&await N()}catch(E){i.value="Failed to delete",f("Failed to delete item"),console.error("Error deleting item:",E)}}async function fe(l){if(!l&&!y.value)return;const d=l?typeof l=="string"?l:l.name:y.value.name,h=F(a.value,d);try{await j.downloadFile(h,d)}catch(S){f("Download failed: "+(S.message||"Unknown error")),console.error("Download error:",S)}}async function me(l){var h,S;const d=l.target;if(d.files&&d.files.length>0){const E=d.files[0];m.value={isUploading:!0,percentage:0,loaded:0,total:E.size,fileName:E.name};try{const R=new FormData;R.append("file",E),R.append("path",a.value),await j.post("/file/upload",R,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:K=>{const pe=Math.round(K.loaded*100/K.total);m.value={...m.value,percentage:pe,loaded:K.loaded}}}),await t(),await s(),d.value="",k(`File "${E.name}" uploaded successfully`,5e3,!0)}catch(R){f(`Upload failed for "${E.name}": `+(((S=(h=R.response)==null?void 0:h.data)==null?void 0:S.detail)||R.message||"Unknown error"),8e3,!0),console.error("Upload error:",R)}finally{setTimeout(()=>{m.value.isUploading=!1},1e3)}}}Q(a,async()=>{await t(),await s(),M.value=null,y.value=null});const Z=async()=>{if(await s(),y.value){const l=typeof y.value=="string"?y.value:y.value.name;await z(l)}};return Y(async()=>{await N(),await s(),await t(),document.addEventListener("models-json-updated",Z)}),he(()=>{document.removeEventListener("models-json-updated",Z)}),(l,d)=>(c(),p("div",qt,[m.value.isUploading?(c(),p("div",Wt,[e("div",Ht,[e("div",Kt,[e("div",Xt,[d[0]||(d[0]=e("i",{class:"fas fa-upload text-primary mr-2"},null,-1)),e("span",Qt," Uploading "+P(m.value.fileName)+"... ",1)]),e("span",Yt,P(m.value.percentage)+"%",1)]),e("div",Zt,[e("div",{class:"bg-primary h-2 rounded-full transition-all duration-300 ease-out",style:X({width:m.value.percentage+"%"})},null,4)]),e("div",eo,P(D(m.value.loaded))+" / "+P(D(m.value.total)),1)])])):T("",!0),e("div",to,[d[4]||(d[4]=e("h2",{class:"text-xl font-semibold text-text-light mb-4"},"File Manager",-1)),i.value?(c(),p("div",oo,P(i.value),1)):T("",!0),e("div",lo,[e("div",so,[e("div",ro,[e("div",{class:"flex items-center justify-between mb-4"},[d[2]||(d[2]=e("h5",{class:"text-lg font-medium"},"Folders",-1)),e("button",{onClick:N,class:"btn btn-sm btn-outline text-sm"},d[1]||(d[1]=[e("i",{class:"fas fa-refresh mr-1"},null,-1),w(" Reload ")]))]),$.value?(c(),p("div",ao,[v(De,{folders:b.value,"current-path":a.value,onSelectFolder:H},null,8,["folders","current-path"])])):(c(),p("div",no,d[3]||(d[3]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-2"}),e("small",{class:"text-text-muted"},"Loading folders...")],-1)])))])]),e("div",io,[v(Jt,{"current-path":a.value,files:x.value,dirs:n.value,"selected-file":y.value,"file-props":M.value,onGoUp:le,onRefresh:_,onFileUpload:me,onCreateDirectory:ae,onNavigateToFolder:H,onSelectFile:se,onRename:re,onDelete:ce,onDownload:fe,onCopy:ne},null,8,["current-path","files","dirs","selected-file","file-props"])])])])]))}},fo=oe(uo,[["__scopeId","data-v-0c9f06a4"]]);export{fo as default};
