import{c as i,a as D,o as a,b as t,r as at,d as w,e as B,f as L,g as ct,h as Mt,i as rt,j as h,n as j,u as d,F as C,t as p,k as mt,l as Tt,w as et,T as jt,m as It,_ as gt,p as kt,q as $t,s as R,v as ht,x as Pt,y as nt,z as Ct,A as Dt,B as Bt,C as Ot,D as V,E as W,G as vt,H as Ft,I as bt,J as yt,K as Et,L as zt,M as At,N as wt,O as Lt,P as Ut,Q as Vt}from"./index-BmZi0HzE.js";import{_ as _t}from"./CommonCard-Cnyfhz5m.js";import{A as St}from"./AccordionComponent-DUjQgGlx.js";/* empty css                                                                           */const Wt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},Gt={class:"bg-background rounded-lg shadow-xl max-w-4xl w-full max-h-[80vh] overflow-hidden mx-4"},Ht={class:"flex justify-between items-center p-4 border-b border-border"},qt={class:"text-lg font-semibold text-text-light"},Nt={class:"p-6 overflow-y-auto max-h-[70vh]"},Rt={class:"flex justify-end space-x-3 p-4 border-t border-border bg-background-mute"},Kt={__name:"CommonModal",props:{show:{type:Boolean,required:!0}},emits:["close"],setup(A){return(b,g)=>A.show?(a(),i("div",Wt,[t("div",Gt,[t("div",Ht,[t("h3",qt,[at(b.$slots,"title",{},()=>[g[2]||(g[2]=w("Modal Title"))])]),t("button",{type:"button",class:"text-text-muted hover:text-text-light",onClick:g[0]||(g[0]=m=>b.$emit("close"))},[at(b.$slots,"close-icon",{},()=>[g[3]||(g[3]=t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",class:"w-6 h-6"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1))])])]),t("div",Nt,[at(b.$slots,"default")]),t("div",Rt,[at(b.$slots,"footer",{},()=>[t("button",{type:"button",class:"btn btn-secondary",onClick:g[1]||(g[1]=m=>b.$emit("close"))},"Close")])])])])):D("",!0)}},Jt={class:"relative"},Qt=["disabled","title","data-dropdown-id"],Yt=["data-dropdown-id"],Xt={class:"p-2"},Zt={__name:"DropdownComponent",props:{buttonText:{type:String,required:!0},buttonIcon:{type:Object,default:null},size:{type:String,default:"m",validator:A=>["xs","m","l"].includes(A)},variant:{type:String,default:"primary"},disabled:{type:Boolean,default:!1},title:{type:String,default:""},dropdownWidth:{type:Number,default:200},align:{type:String,default:"left",validator:A=>["left","right"].includes(A)}},emits:["item-selected"],setup(A,{emit:b}){const g=A,m=b,E=B(!1),k=B({top:0,left:0}),x=B(`dropdown-${Math.random().toString(36).substr(2,9)}`),$=L(()=>`${`btn btn-${g.variant} flex items-center`} ${{xs:"text-xs px-2 py-1 h-8",m:"text-sm px-3 py-2 h-10",l:"text-base px-4 py-3 h-12"}[g.size]}`),I=L(()=>({xs:"text-xs",m:"text-sm",l:"text-base"})[g.size]),G=y=>{g.disabled||(E.value?v():K(y))},K=y=>{if(y&&y.currentTarget){const S=y.currentTarget.getBoundingClientRect(),H=window.innerWidth,ot=window.innerHeight;let z=S.left,U=S.bottom+4;g.align==="right"&&(z=S.right-g.dropdownWidth),z+g.dropdownWidth>H&&(z=H-g.dropdownWidth-20),z<20&&(z=20);const Q=200;U+Q>ot&&(U=S.top-Q-4,U<20&&(U=S.bottom+4)),k.value={top:U,left:z}}E.value=!0},v=()=>{E.value=!1},lt=y=>{m("item-selected",y),v()},P=y=>{if(!y.target||y.target.closest(`[data-dropdown-id="${x.value}"]`))return;const S=y.target.closest(".dropdown-content");S&&S.dataset.dropdownId===x.value||v()};return ct(()=>{document.addEventListener("click",P),window.addEventListener("scroll",v)}),Mt(()=>{document.removeEventListener("click",P),window.removeEventListener("scroll",v)}),(y,J)=>(a(),i("div",Jt,[t("button",{onClick:G,class:j($.value),disabled:A.disabled,title:A.title,"data-dropdown-id":x.value},[A.buttonIcon?(a(),rt(d(C),{key:0,icon:A.buttonIcon,class:j([I.value,"mr-1"])},null,8,["icon","class"])):D("",!0),w(" "+p(A.buttonText)+" ",1),h(d(C),{icon:d(Tt),class:j([I.value,"ml-1 transition-transform duration-200 ease-in-out"]),style:mt({transform:E.value?"rotate(180deg)":"rotate(0deg)"})},null,8,["icon","class","style"])],10,Qt),(a(),rt(It,{to:"body"},[h(jt,{name:"dropdown","enter-active-class":"transition duration-200 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:et(()=>[E.value?(a(),i("div",{key:0,class:"fixed z-50 bg-background border border-border rounded-lg shadow-lg dropdown-content","data-dropdown-id":x.value,style:mt({top:k.value.top+"px",left:k.value.left+"px",width:A.dropdownWidth+"px"})},[t("div",Xt,[at(y.$slots,"default",{close:v,handleItemClick:lt})])],12,Yt)):D("",!0)]),_:3})]))]))}},te={class:"p-4 bg-background space-y-6"},ee={class:"text-lg font-semibold text-text-light mb-4 flex items-center"},se={class:"flex items-center space-x-4"},le=["disabled"],oe={key:0,class:"text-text-muted flex items-center"},ne={class:"text-text-muted mt-2 text-sm flex items-center"},ae={class:"flex justify-between items-center mb-4"},re={class:"text-xl font-semibold text-text-light flex items-center"},ie={class:"flex items-center space-x-4"},de={class:"text-sm text-text-muted"},ce={class:"relative"},ue={class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-text-light-muted"},fe={class:"mb-6"},pe={class:"text-text-muted mb-4 flex items-center"},xe={class:"relative min-h-[200px]"},ge={key:0,class:"absolute inset-0 flex items-center justify-center bg-background-soft bg-opacity-75 z-10"},me={key:1,class:"space-y-4"},he={class:"flex items-start justify-between"},ve={class:"flex-1"},be={class:"text-lg font-semibold text-text-light mb-2"},ye={key:0,class:"text-text-muted text-sm mb-3"},we={class:"mb-4"},_e={class:"flex flex-wrap gap-2"},ke={class:"ml-1"},$e={class:"flex items-center text-sm"},Ce={class:"mr-4 text-text-muted"},De={class:"flex items-center space-x-2 ml-4"},Be=["onClick"],Ae=["onClick"],Se={class:"text-text-light text-sm"},Me={class:"text-text-muted text-xs"},Te={class:"border-t border-border mt-2 pt-2"},je=["onClick"],Ie=["onClick"],Pe=["onClick"],Oe={key:2,class:"text-center text-text-muted py-6"},Fe={key:0},Ee={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},ze={class:"font-medium text-text-light mb-2 flex items-center"},Le={class:"space-y-2"},Ue={class:"text-text-light"},Ve={class:"text-text-light"},We={class:"text-text-light"},Ge={key:0},He={class:"text-text-light"},qe=["href"],Ne={class:"font-medium text-text-light mb-2 flex items-center"},Re={class:"text-text-light"},Ke={class:"mb-6"},Je={class:"font-medium text-text-light mb-3 flex items-center"},Qe={key:0,class:"flex flex-wrap gap-2"},Ye={key:1,class:"text-text-muted"},Xe={class:"font-medium text-text-light mb-3 flex items-center"},Ze={key:0,class:"space-y-2"},ts={class:"px-2 pb-2"},es={key:0,class:"text-text-muted mb-3 mt-2"},ss={key:1},ls={class:"grid grid-cols-1 gap-2 max-h-60 overflow-y-auto"},os={class:"flex-1 min-w-0"},ns={class:"flex items-center"},as={class:"font-medium text-text-light truncate mr-3"},rs={key:0,class:"inline-flex items-center px-2 py-1 rounded text-xs bg-green-800 text-white",title:"Model is installed on disk"},is={key:1,class:"inline-flex items-center px-2 py-1 rounded text-xs bg-gray-600 text-white",title:"Model is not installed on disk"},ds={class:"text-xs text-text-muted mt-1"},cs={class:"inline-flex items-center mr-3"},us={key:0,class:"inline-flex items-center"},fs={key:2,class:"text-text-muted text-sm"},ps={key:1,class:"text-text-muted"},xs={__name:"DownloadBundlesComponent",setup(A){const{success:b,error:g,confirm:m}=kt(),{startInstallation:E}=$t(),k=B(""),x=B(!1),$=B([]),I=B([]),G=B({}),K=B(!1),v=B(null),lt=B(new Set);B(new Map);const P=async()=>{var n,s;try{const o=await R.get("/bundles/");$.value=o.data||[]}catch(o){g("Failed to load uploaded bundles: "+(((s=(n=o.response)==null?void 0:n.data)==null?void 0:s.message)||o.message))}},y=async()=>{var n,s;try{const o=await R.get("/bundles/installed/");I.value=o.data||[]}catch(o){g("Failed to load installed bundles: "+(((s=(n=o.response)==null?void 0:n.data)==null?void 0:s.message)||o.message))}},J=async()=>{var n,s;try{const o=await R.get("/models/");G.value=o.data||{}}catch(o){g("Failed to load models data: "+(((s=(n=o.response)==null?void 0:n.data)==null?void 0:s.message)||o.message))}},S=n=>{const s=G.value.groups||{};for(const o in s){const u=s[o];for(const f of u)if(f.dest===n.dest&&n.dest||f.url===n.url&&n.url)return f.exists||!1}return!1},H=(n,s=null)=>I.value.some(o=>o.id===n&&(!s||o.profile===s)),ot=async n=>{var s,o;x.value=!0;try{const u=new FormData;u.append("bundle_file",n),await R.post("/bundles/upload/",u,{headers:{"Content-Type":"multipart/form-data"}}),b(`Bundle "${n.name}" uploaded successfully`),await P()}catch(u){g("Failed to upload bundle: "+(((o=(s=u.response)==null?void 0:s.data)==null?void 0:o.detail)||u.message))}finally{x.value=!1}},z=async n=>{const s=n.target.files[0];s&&(await ot(s),n.target.value="")},U=()=>{document.getElementById("bundle-upload-file").click()},Q=n=>{const s=Object.keys(n.hardware_profiles||{}),o=s.filter(u=>H(n.id,u));return o.length===0?{status:"not-installed",text:"Not Installed"}:o.length===s.length?{status:"fully-installed",text:"Fully Installed"}:{status:"partially-installed",text:`Partially Installed (${o.length}/${s.length})`}},ut=async n=>{var s,o;try{if(await m(`Are you sure you want to uninstall bundle "${n.name}"?`,"Confirm Uninstall")){x.value=!0;const f=Object.keys(n.hardware_profiles||{});for(const F of f)H(n.id,F)&&await R.post("/bundles/uninstall",{bundle_id:n.id,profile:F});b(`Bundle "${n.name}" uninstalled successfully`),await y()}}catch(u){g("Failed to uninstall bundle: "+(((o=(s=u.response)==null?void 0:s.data)==null?void 0:o.detail)||u.message))}finally{x.value=!1}},ft=async n=>{var s,o;try{await m(`Are you sure you want to delete the uploaded bundle "${n.name}"? This will remove it from the server permanently.`,"Confirm Delete")&&(x.value=!0,await R.delete(`/bundles/${n.id}`),b(`Bundle "${n.name}" deleted successfully`),await P(),await y())}catch(u){g("Failed to delete bundle: "+(((o=(s=u.response)==null?void 0:s.data)==null?void 0:o.detail)||u.message))}finally{x.value=!1}},O=n=>{v.value=n,K.value=!0},Y=()=>{K.value=!1,v.value=null,lt.value.clear()},pt=n=>n.dest?n.dest.split("/").pop():n.url?n.url.split("/").pop():"Unknown model",it=L(()=>{if(!k.value)return $.value;const n=k.value.toLowerCase();return $.value.filter(s=>s.name.toLowerCase().includes(n)||s.description.toLowerCase().includes(n)||s.workflows&&s.workflows.some(o=>o.toLowerCase().includes(n)))});ct(async()=>{await Promise.all([P(),y(),J()])});const M=n=>Object.keys(n.hardware_profiles||{}).filter(o=>!H(n.id,o)),xt=n=>Object.keys(n.hardware_profiles||{}).filter(o=>H(n.id,o)),X=(n,s)=>{var F;const o=(F=n.hardware_profiles)==null?void 0:F[s];if(!o||!o.models)return{installed:0,total:0};const u=o.models.length;return{installed:o.models.filter(N=>S(N)).length,total:u}},Z=(n,s)=>{s==="install-all"?dt(n):q(n,[s])},q=async(n,s)=>{var o,u;try{if(!s||s.length===0){g("Please select at least one profile to install");return}await E(n.id,n.name,s),setTimeout(async()=>{await y()},2e3),b(`Started installation of ${s.length} profile(s) for bundle "${n.name}"`)}catch(f){g("Failed to start profile installation: "+(((u=(o=f.response)==null?void 0:o.data)==null?void 0:u.detail)||f.message))}},dt=async n=>{const s=M(n);if(s.length===0){b(`Bundle "${n.name}" is already fully installed`);return}await q(n,s)};return(n,s)=>(a(),i("div",te,[h(_t,null,{default:et(()=>[t("h3",ee,[h(d(C),{icon:d(ht),class:"mr-2"},null,8,["icon"]),s[1]||(s[1]=w(" Upload Bundle "))]),t("div",se,[t("input",{type:"file",class:"hidden",id:"bundle-upload-file",onChange:z,accept:".json"},null,32),t("button",{class:"btn btn-primary",onClick:U,disabled:x.value},[h(d(C),{icon:d(ht),class:"mr-1"},null,8,["icon"]),s[2]||(s[2]=w("Upload Bundle File "))],8,le),x.value?(a(),i("div",oe,[h(d(C),{icon:d(Pt),class:"animate-spin mr-1"},null,8,["icon"]),s[3]||(s[3]=w(" Processing... "))])):D("",!0)]),t("p",ne,[h(d(C),{icon:d(nt),class:"mr-1"},null,8,["icon"]),s[4]||(s[4]=w(" Upload a JSON bundle file to add it to your collection. You can then install or manage it below. "))])]),_:1}),h(_t,null,{default:et(()=>[t("div",ae,[t("h2",re,[h(d(C),{icon:d(Ct),class:"mr-2"},null,8,["icon"]),s[5]||(s[5]=w(" Uploaded Bundles "))]),t("div",ie,[t("div",de,p($.value.length)+" bundle"+p($.value.length!==1?"s":"")+" uploaded ",1),t("div",ce,[Dt(t("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>k.value=o),type:"text",placeholder:"Search bundles",class:"form-input pl-10"},null,512),[[Bt,k.value]]),t("span",ue,[h(d(C),{icon:d(Ot)},null,8,["icon"])])])])]),t("div",fe,[t("p",pe,[h(d(C),{icon:d(nt),class:"mr-2"},null,8,["icon"]),s[6]||(s[6]=w(" Manage your uploaded bundles: view details, install/uninstall, or delete them. "))]),t("div",xe,[x.value?(a(),i("div",ge,s[7]||(s[7]=[t("div",{class:"flex flex-col items-center"},[t("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"}),t("span",{class:"mt-2 text-text-light"},"Processing...")],-1)]))):D("",!0),it.value.length>0?(a(),i("div",me,[(a(!0),i(V,null,W(it.value,o=>(a(),i("div",{key:o.id,class:"bg-background-soft border border-border rounded-lg p-6 hover:shadow-md transition-shadow"},[t("div",he,[t("div",ve,[t("h4",be,p(o.name),1),o.description?(a(),i("p",ye,p(o.description),1)):D("",!0),t("div",we,[s[8]||(s[8]=t("h5",{class:"text-sm font-medium text-text-light mb-2"},"Hardware Profiles:",-1)),t("div",_e,[(a(!0),i(V,null,W(o.hardware_profiles,(u,f)=>(a(),i("span",{key:f,class:j(["inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border",X(o,f).installed===X(o,f).total&&X(o,f).total>0?"bg-green-100 text-green-800 border-green-200":X(o,f).installed>0?"bg-yellow-100 text-yellow-800 border-yellow-200":"bg-blue-100 text-blue-800 border-blue-200"])},[h(d(C),{icon:d(vt),class:"mr-1"},null,8,["icon"]),w(" "+p(f)+" ",1),t("span",ke," ("+p(X(o,f).installed)+"/"+p(X(o,f).total)+") ",1)],2))),128))])]),t("div",$e,[t("span",Ce,[s[9]||(s[9]=w(" Status: ")),t("span",{class:j(["font-medium",Q(o).color])},p(Q(o).text),3)])])]),t("div",De,[t("button",{onClick:u=>O(o),class:"btn btn-secondary-outline text-sm h-8",title:"View bundle details"},[h(d(C),{icon:d(nt),class:"mr-1"},null,8,["icon"]),s[10]||(s[10]=w(" Details "))],8,Be),M(o).length>0?(a(),rt(Zt,{key:0,"button-text":"Install","button-icon":d(Ft),size:"xs",variant:"primary",title:"Install bundle profiles","dropdown-width":250,align:"left",onItemSelected:u=>Z(o,u)},{default:et(({handleItemClick:u})=>[s[11]||(s[11]=t("div",{class:"text-sm font-medium text-text-light mb-2"}," Select profiles to install: ",-1)),(a(!0),i(V,null,W(M(o),f=>{var F,N,st;return a(),i("div",{key:f,class:"flex items-center justify-between p-2 hover:bg-background-soft rounded cursor-pointer",onClick:e=>u(f)},[t("span",Se,p(f),1),t("span",Me,p(((st=(N=(F=o.hardware_profiles)==null?void 0:F[f])==null?void 0:N.models)==null?void 0:st.length)||0)+" models ",1)],8,Ae)}),128)),t("div",Te,[t("div",{class:"w-full text-left p-2 text-sm text-primary hover:bg-background-soft rounded cursor-pointer",onClick:f=>u("install-all")}," Install All Profiles ",8,je)])]),_:2},1032,["button-icon","onItemSelected"])):D("",!0),xt(o).length>0?(a(),i("button",{key:1,onClick:u=>ut(o),class:"btn btn-danger text-sm h-8",title:"Uninstall bundle"},[h(d(C),{icon:d(bt),class:"mr-1"},null,8,["icon"]),s[12]||(s[12]=w(" Uninstall "))],8,Ie)):D("",!0),t("button",{onClick:u=>ft(o),class:"btn btn-danger text-sm h-8",title:"Delete bundle file"},[h(d(C),{icon:d(bt)},null,8,["icon"])],8,Pe)])])]))),128))])):(a(),i("div",Oe," No bundles found. "))])])]),_:1}),h(Kt,{show:K.value,onClose:Y},{title:et(()=>{var o;return[w(" Bundle Details: "+p((o=v.value)==null?void 0:o.name),1)]}),default:et(()=>{var o,u;return[v.value?(a(),i("div",Fe,[t("div",Ee,[t("div",null,[t("h4",ze,[h(d(C),{icon:d(nt),class:"mr-2"},null,8,["icon"]),s[13]||(s[13]=w("Basic Information "))]),t("dl",Le,[t("div",null,[s[14]||(s[14]=t("dt",{class:"text-sm text-text-muted"},"Name:",-1)),t("dd",Ue,p(v.value.name),1)]),t("div",null,[s[15]||(s[15]=t("dt",{class:"text-sm text-text-muted"},"Version:",-1)),t("dd",Ve,p(v.value.version||"1.0.0"),1)]),t("div",null,[s[16]||(s[16]=t("dt",{class:"text-sm text-text-muted"},"Author:",-1)),t("dd",We,p(v.value.author||"N/A"),1)]),v.value.website?(a(),i("div",Ge,[s[17]||(s[17]=t("dt",{class:"text-sm text-text-muted"},"Website:",-1)),t("dd",He,[t("a",{href:v.value.website,target:"_blank",class:"text-primary hover:underline"},p(v.value.website),9,qe)])])):D("",!0)])]),t("div",null,[t("h4",Ne,[h(d(C),{icon:d(nt),class:"mr-2"},null,8,["icon"]),s[18]||(s[18]=w("Description "))]),t("p",Re,p(v.value.description),1)])]),t("div",Ke,[t("h4",Je,[h(d(C),{icon:d(yt),class:"mr-2"},null,8,["icon"]),w("Workflows ("+p(((o=v.value.workflows)==null?void 0:o.length)||0)+") ",1)]),((u=v.value.workflows)==null?void 0:u.length)>0?(a(),i("div",Qe,[(a(!0),i(V,null,W(v.value.workflows,f=>(a(),i("span",{key:f,class:"inline-flex items-center px-3 py-1 rounded text-sm bg-blue-600 text-white"},[h(d(C),{icon:d(yt),class:"mr-1"},null,8,["icon"]),w(p(f),1)]))),128))])):(a(),i("p",Ye,"No workflows defined."))]),t("div",null,[t("h4",Xe,[h(d(C),{icon:d(vt),class:"mr-2"},null,8,["icon"]),w("Hardware Profiles ("+p(Object.keys(v.value.hardware_profiles||{}).length)+") ",1)]),Object.keys(v.value.hardware_profiles||{}).length>0?(a(),i("div",Ze,[(a(!0),i(V,null,W(v.value.hardware_profiles,(f,F)=>{var N;return a(),rt(St,{key:F,title:F+" ("+(((N=f.models)==null?void 0:N.length)||0)+" models)",icon:"server",size:"xs"},{default:et(()=>{var st;return[t("div",ts,[f.description?(a(),i("p",es,p(f.description),1)):D("",!0),((st=f.models)==null?void 0:st.length)>0?(a(),i("div",ss,[s[21]||(s[21]=t("h6",{class:"text-sm font-medium text-text-light mb-2"},"Models:",-1)),t("div",ls,[(a(!0),i(V,null,W(f.models,(e,l)=>(a(),i("div",{key:l,class:"flex items-center justify-between p-3 bg-background rounded border text-sm"},[t("div",os,[t("div",ns,[t("div",as,p(pt(e)),1),S(e)?(a(),i("span",rs,[h(d(C),{icon:d(Et),class:"mr-1"},null,8,["icon"]),s[19]||(s[19]=w(" Installed "))])):(a(),i("span",is,[h(d(C),{icon:d(zt),class:"mr-1"},null,8,["icon"]),s[20]||(s[20]=w(" Not Installed "))]))]),t("div",ds,[t("span",cs,[h(d(C),{icon:d(At),class:"mr-1"},null,8,["icon"]),w(p(e.type),1)]),e.tags&&e.tags.length>0?(a(),i("span",us," Tags: "+p(e.tags.join(", ")),1)):D("",!0)])])]))),128))])])):(a(),i("div",fs,"No models in this profile."))])]}),_:2},1032,["title"])}),128))])):(a(),i("p",ps,"No hardware profiles defined."))])])):D("",!0)]}),_:1},8,["show"])]))}},gs=gt(xs,[["__scopeId","data-v-69d7b2bf"]]),ms={class:"download-models-container w-full p-4 space-y-4"},hs={class:"models-card bg-background-soft border border-border rounded-lg shadow-md"},vs={class:"flex items-center justify-between p-4 border-b border-border"},bs={class:"header-actions flex gap-2"},ys=["disabled"],ws=["disabled"],_s={class:"p-4 space-y-4"},ks={class:"filter-section bg-background-mute border border-border rounded-lg p-4 space-y-3"},$s={class:"flex items-center gap-2 mb-2"},Cs={class:"relative"},Ds={key:0,class:"space-y-2"},Bs={class:"flex flex-wrap gap-2"},As=["onClick"],Ss={key:0,class:"ml-1"},Ms={key:1,class:"text-xs text-text-light-muted"},Ts={key:0},js={key:1},Is={key:0,class:"text-center text-text-light-muted py-8"},Ps={key:1,class:"space-y-4"},Os={class:"table-responsive"},Fs={class:"overflow-x-auto"},Es={class:"w-full text-sm"},zs={class:"bg-background-mute"},Ls={class:"p-2 text-left"},Us=["checked","onChange","disabled"],Vs={class:"p-2"},Ws=["checked","onChange","disabled"],Gs={class:"p-2"},Hs={class:"p-2"},qs={key:0,class:"flex flex-wrap gap-1"},Ns={key:1,class:"text-text-light-muted"},Rs={class:"p-2 text-text-light"},Ks={class:"p-2 text-text-light"},Js={class:"p-2"},Qs=["href"],Ys={key:1,class:"text-text-light-muted"},Xs={class:"p-2"},Zs={class:"p-2"},tl={class:"flex gap-2"},el=["onClick","disabled"],sl=["onClick","disabled"],ll={name:"DownloadModelsComponent"},ol=Object.assign(ll,{setup(A){const b=B([]),g=B({}),m=B({}),E=B(!1),k=B({}),x=B(""),$=B([]),{showNotification:I,showDialog:G}=kt(),{rawDownloads:K,refreshDownloads:v,startGlobalDownloadPolling:lt}=$t(),P=K,y=async()=>{E.value=!0;try{const{data:e}=await R.get("/models/"),l={};let c=[];e.config&&(k.value=e.config);for(const[_,r]of Object.entries(e.groups||{}))l[_]=r,c=c.concat(r.map(T=>({...T,group:_})));b.value=c,g.value=l,m.value={...m.value}}finally{E.value=!1}};let J={};wt(()=>{for(const e in J)if(!(e in P.value)||P.value[e]&&P.value[e].progress===100){y();break}J={...P.value}}),L(()=>Object.entries(P.value).map(([e,l])=>({entry:b.value.find(_=>(_.dest||_.git)===e)||{},progress:l.progress,status:l.status}))),B(!1);const S=B([]),H=(e,l)=>{const c=S.value.indexOf(e);l&&c===-1?S.value.push(e):!l&&c>-1&&S.value.splice(c,1)},ot=(e,l)=>{const c=O(e);l?m.value[c]=!0:delete m.value[c],m.value={...m.value}},z=L(()=>{const e=new Set;return b.value.forEach(l=>{l.tags&&(Array.isArray(l.tags)?l.tags.forEach(c=>e.add(c)):e.add(l.tags))}),Array.from(e).sort()}),U=L(()=>{let e=b.value;if(x.value.trim()){const l=x.value.toLowerCase().trim();e=e.filter(c=>{const _=(Y(c.dest)||c.git||"").toLowerCase(),r=c.tags?(Array.isArray(c.tags)?c.tags.join(" "):c.tags).toLowerCase():"";return _.includes(l)||r.includes(l)})}return $.value.length>0&&(e=e.filter(l=>{if(!l.tags)return!1;const c=Array.isArray(l.tags)?l.tags:[l.tags];return $.value.every(_=>c.some(r=>r.toLowerCase()===_.toLowerCase()))})),e}),Q=L(()=>{const e={};U.value.forEach(r=>{const T=r.group||"Other";e[T]||(e[T]=[]),e[T].push(r)});const l={},c=k.value.group_order||[];return c.forEach(r=>{e[r]&&(l[r]=e[r])}),Object.keys(e).filter(r=>!c.includes(r)).sort().forEach(r=>{l[r]=e[r]}),l}),ut=e=>{const l=$.value.indexOf(e);l>-1?$.value.splice(l,1):$.value.push(e)},ft=()=>{x.value="",$.value=[]},O=e=>e.url||e.git,Y=e=>(e==null?void 0:e.split("/").pop())||"",pt=e=>e?e>1e9?(e/1e9).toFixed(2)+" GB":e>1e6?(e/1e6).toFixed(2)+" MB":e>1e3?(e/1e3).toFixed(2)+" KB":e+" B":"-",it=e=>{const l=e.tags;return l?Array.isArray(l)?l.includes("nsfw"):l==="nsfw":!1},M=e=>!!P.value[O(e)],xt=e=>e.filter(l=>!M(l)).every(l=>m.value[O(l)]),X=(e,l)=>{for(const c of e)M(c)||(m.value[O(c)]=l)},Z=L(()=>b.value.filter(e=>m.value[O(e)]&&e.exists)),q=L(()=>b.value.filter(e=>m.value[O(e)]&&!e.exists&&!P.value[O(e)]));wt(()=>{console.log("selectedToDelete:",Z.value.map(e=>O(e))),console.log("selectedToDownload:",q.value.map(e=>O(e)))});const dt=L(()=>Z.value.length>0),n=L(()=>q.value.length>0);function s(e){for(const l of e)delete m.value[O(l)];m.value={...m.value}}const o=async()=>{if(!Z.value.length)return;await G({title:"Delete selected models",message:`Are you sure you want to delete ${Z.value.length} model(s)?`,type:"confirm",confirmText:"Delete",cancelText:"Cancel"})&&(await f(Z.value),s(Z.value))},u=async()=>{if(!q.value.length)return;await G({title:"Download selected models",message:`Download ${q.value.length} model(s)?`,type:"confirm",confirmText:"Download",cancelText:"Cancel"})&&(await F(q.value),s(q.value))};async function f(e){try{const l=await R.post("/models/delete",e);let _=(Array.isArray(l.data)?l.data:[l.data]).filter(r=>!r.ok);_.length?_.forEach(r=>I(r.msg||"Delete failed","error")):I(Array.isArray(e)&&e.length>1?"Selected models deleted":"Model deleted","success"),await y()}catch{I("Delete operation failed","error")}}async function F(e){try{const c=(Array.isArray(e)?e:[e]).filter(tt=>M(tt));if(c.length>0){I(`Some models are already downloading: ${c.map(tt=>Y(tt.dest)||tt.git).join(", ")}`,"warning");return}lt();const _=await R.post("/models/download",e);let T=(Array.isArray(_.data)?_.data:[_.data]).filter(tt=>!tt.ok);T.length?T.forEach(tt=>I(tt.msg||"Download failed","error")):(I(Array.isArray(e)&&e.length>1?"Selected models downloading":"Download started","success"),setTimeout(async()=>{await v(),console.log("Downloads refreshed after POST, current downloads:",Object.keys(K.value))},1e3)),await y()}catch{I("Download operation failed","error")}}const N=async e=>{if(M(e)){I(`Model "${Y(e.dest)||e.git}" is already downloading`,"warning");return}await G({title:"Download model",message:`Download model "${Y(e.dest)||e.git}"?`,type:"confirm",confirmText:"Download",cancelText:"Cancel"})&&await F(e)},st=async e=>{await G({title:"Delete model",message:`Delete model "${Y(e.dest)||e.git}"?`,type:"confirm",confirmText:"Delete",cancelText:"Cancel"})&&await f(e)};return ct(async()=>{await y(),await v(),lt()}),(e,l)=>(a(),i("div",ms,[t("div",hs,[t("div",vs,[l[1]||(l[1]=t("div",{class:"flex items-center gap-2"},[t("svg",{class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"})]),t("span",{class:"text-lg font-bold text-white"},"Model Manager")],-1)),t("div",bs,[t("button",{disabled:!dt.value,onClick:o,class:j(["px-4 py-2 rounded text-sm font-medium transition-colors",dt.value?"bg-red-600 hover:bg-red-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"])},"Delete selected",10,ys),t("button",{disabled:!n.value,onClick:u,class:j(["px-4 py-2 rounded text-sm font-medium transition-colors",n.value?"bg-primary hover:bg-primary-dark text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"])},"Download selected",10,ws)])]),t("div",_s,[t("div",ks,[t("div",$s,[l[2]||(l[2]=t("svg",{class:"w-5 h-5 text-text-light",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.414A1 1 0 013 6.707V4z"})],-1)),l[3]||(l[3]=t("span",{class:"font-medium text-text-light"},"Filters",-1)),x.value||$.value.length>0?(a(),i("button",{key:0,onClick:ft,class:"ml-auto px-2 py-1 text-xs bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors"}," Clear All ")):D("",!0)]),t("div",Cs,[Dt(t("input",{"onUpdate:modelValue":l[0]||(l[0]=c=>x.value=c),type:"text",placeholder:"Search by name or tags...",class:"w-full px-3 py-2 pl-10 bg-background border border-border rounded-md text-text-light placeholder-text-light-muted focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[Bt,x.value]]),l[4]||(l[4]=t("svg",{class:"absolute left-3 top-2.5 w-4 h-4 text-text-light-muted",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),z.value.length>0?(a(),i("div",Ds,[l[5]||(l[5]=t("span",{class:"text-sm font-medium text-text-light"},"Filter by tags:",-1)),t("div",Bs,[(a(!0),i(V,null,W(z.value,c=>(a(),i("button",{key:c,onClick:_=>ut(c),class:j(["px-3 py-1 text-xs rounded-full border transition-colors",$.value.includes(c)?"bg-primary text-white border-primary":"bg-background border-border text-text-light hover:bg-background-mute"])},[w(p(c)+" ",1),$.value.includes(c)?(a(),i("span",Ss,"×")):D("",!0)],10,As))),128))])])):D("",!0),x.value||$.value.length>0?(a(),i("div",Ms,[w(" Showing "+p(U.value.length)+" of "+p(b.value.length)+" models ",1),x.value?(a(),i("span",Ts,' matching "'+p(x.value)+'"',1)):D("",!0),$.value.length>0?(a(),i("span",js," with tags: "+p($.value.join(", ")),1)):D("",!0)])):D("",!0)]),Object.keys(Q.value).length===0?(a(),i("div",Is,p(x.value||$.value.length>0?"No models match the current filters.":"No models found."),1)):(a(),i("div",Ps,[(a(!0),i(V,null,W(Q.value,(c,_)=>(a(),rt(St,{key:_,title:_,size:"xs",defaultOpen:S.value.includes(_),onToggle:r=>H(_,r)},{default:et(()=>[t("div",Os,[t("div",Fs,[t("table",Es,[t("thead",zs,[t("tr",null,[t("th",Ls,[t("input",{type:"checkbox",checked:xt(c),onChange:r=>X(c,r.target.checked),disabled:c.every(r=>M(r)),class:"rounded"},null,40,Us)]),l[6]||(l[6]=t("th",{class:"p-2 text-left text-text-light"},"Name",-1)),l[7]||(l[7]=t("th",{class:"p-2 text-left text-text-light"},"Tags",-1)),l[8]||(l[8]=t("th",{class:"p-2 text-left text-text-light"},"Type",-1)),l[9]||(l[9]=t("th",{class:"p-2 text-left text-text-light"},"Size",-1)),l[10]||(l[10]=t("th",{class:"p-2 text-left text-text-light"},"Source",-1)),l[11]||(l[11]=t("th",{class:"p-2 text-left text-text-light"},"Present",-1)),l[12]||(l[12]=t("th",{class:"p-2 text-left text-text-light"},"Action",-1))])]),t("tbody",null,[(a(!0),i(V,null,W(c,r=>(a(),i("tr",{key:O(r),class:j(["border-b border-border hover:bg-background-mute transition-colors",M(r)?"is-downloading":""])},[t("td",Vs,[t("input",{type:"checkbox",checked:m.value[O(r)]||!1,onChange:T=>ot(r,T.target.checked),disabled:M(r),class:"rounded"},null,40,Ws)]),t("td",Gs,[t("span",{class:j(["font-medium",M(r)?"opacity-50":"",it(r)?"text-red-400":"text-text-light"])},p(Y(r.dest)||r.git),3)]),t("td",Hs,[r.tags&&r.tags.length?(a(),i("div",qs,[(a(!0),i(V,null,W(Array.isArray(r.tags)?r.tags:[r.tags],T=>(a(),i("span",{key:T,class:"px-2 py-1 bg-blue-600 text-white text-xs rounded"},p(T),1))),128))])):(a(),i("span",Ns,"-"))]),t("td",Rs,p(r.type||_),1),t("td",Ks,p(r.size?pt(r.size):"-"),1),t("td",Js,[r.src?(a(),i("a",{key:0,href:r.src,target:"_blank",rel:"noopener",class:"text-primary hover:text-primary-light underline"}," Link ",8,Qs)):(a(),i("span",Ys,"-"))]),t("td",Xs,[t("span",{class:j(["px-2 py-1 text-xs rounded",r.exists?"bg-green-600 text-white":"bg-red-600 text-white"])},p(r.exists?"Yes":"No"),3)]),t("td",Zs,[t("div",tl,[r.exists?D("",!0):(a(),i("button",{key:0,onClick:T=>N(r),disabled:M(r),class:j(["px-3 py-1 rounded text-sm transition-colors",M(r)?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-primary hover:bg-primary-dark text-white"])}," Download ",10,el)),r.exists?(a(),i("button",{key:1,onClick:T=>st(r),disabled:M(r),class:j(["px-3 py-1 rounded text-sm transition-colors",M(r)?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700 text-white"])}," Delete ",10,sl)):D("",!0)])])],2))),128))])])])])]),_:2},1032,["title","defaultOpen","onToggle"]))),128))]))])])]))}}),nl=gt(ol,[["__scopeId","data-v-ef39e2ae"]]),al={class:"install-page p-4 bg-background min-h-screen"},rl={class:"bg-background-soft border border-border rounded-lg"},il={class:"border-b border-border"},dl={class:"flex space-x-0","aria-label":"Tabs"},cl={class:"tab-content"},ul={key:0,class:"tab-pane"},fl={key:1,class:"tab-pane"},pl={__name:"InstallPage",setup(A){const b=Lt(),g=Vt(),m=B("bundles");ct(()=>{const k=b.query.tab;(k==="models"||k==="bundles")&&(m.value=k)}),Ut(()=>b.query.tab,k=>{(k==="models"||k==="bundles")&&(m.value=k)});const E=k=>{m.value=k,g.push({name:"install",query:{tab:k}})};return(k,x)=>(a(),i("div",al,[t("div",rl,[t("div",il,[t("nav",dl,[t("button",{onClick:x[0]||(x[0]=$=>E("bundles")),class:j(["px-6 py-4 text-sm font-medium border-b-2 transition-colors duration-200",m.value==="bundles"?"border-primary text-primary bg-primary bg-opacity-10":"border-transparent text-text-muted hover:text-text-light hover:border-border"])},[h(d(C),{icon:d(Ct),class:"mr-2"},null,8,["icon"]),x[2]||(x[2]=w(" Install Bundles "))],2),t("button",{onClick:x[1]||(x[1]=$=>E("models")),class:j(["px-6 py-4 text-sm font-medium border-b-2 transition-colors duration-200",m.value==="models"?"border-primary text-primary bg-primary bg-opacity-10":"border-transparent text-text-muted hover:text-text-light hover:border-border"])},[h(d(C),{icon:d(At),class:"mr-2"},null,8,["icon"]),x[3]||(x[3]=w(" Install Models "))],2)])]),t("div",cl,[m.value==="bundles"?(a(),i("div",ul,[h(gs)])):D("",!0),m.value==="models"?(a(),i("div",fl,[h(nl)])):D("",!0)])])]))}},vl=gt(pl,[["__scopeId","data-v-655b6d9f"]]);export{vl as default};
