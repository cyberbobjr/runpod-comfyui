import{d as ce,r as A,c as O,o as ae,a as Be,b as i,e as a,f as e,g as re,n as I,h as B,i as _,u as c,F as $,t as g,j as h,k as pe,l as Ae,T as Se,w as Q,m as Me,p as Te,_ as ue,q as ye,s as xe,v as Ie,x as ne,y as we,z as _e,A as ke,B as Pe,C as G,D as H,E as ge,G as je,H as he,I as me,J as Fe,K as Oe,L as $e,M as se,N as Ce,O as Ue,P as ve,Q as ze,R as Ee,S as Le}from"./index-jy5-nOjD.js";import{_ as be,a as Ve}from"./CommonModal.vue_vue_type_script_setup_true_lang-DHWmlz8S.js";import{A as De}from"./AccordionComponent-Eg9b-t0g.js";const Re=["disabled","title","data-dropdown-id"],Ge=["disabled","data-dropdown-id"],He=["data-dropdown-id"],We={class:"p-2 max-h-64 overflow-auto"},qe=ce({__name:"ButtonDropdownComponent",props:{buttonText:{},buttonIcon:{},size:{default:"m"},variant:{default:"primary"},disabled:{type:Boolean,default:!1},title:{default:""},dropdownAlign:{default:"left"}},emits:["item-selected","click"],setup(ie,{emit:S}){const m=ie,M=S,v=A(!1),b=A({top:0,left:0}),x=A(`dropdown-${Math.random().toString(36).substr(2,9)}`),y=A(),P=A(),E=O(()=>`${`btn btn-${m.variant} flex items-center justify-center`} ${{xs:"text-xs px-2 py-1 h-8",m:"text-sm px-3 py-2 h-10",l:"text-base px-4 py-3 h-12"}[m.size]}`),j=O(()=>`${E.value} rounded-r-none border-r-0`);function w(u){switch(u){case"primary":return"hover:bg-primary-dark";case"secondary":return"hover:bg-secondary-dark";case"danger":return"hover:bg-danger-dark";default:return"hover:bg-background-soft"}}function Z(u){switch(u){case"primary":return"border-primary-darker";case"secondary":return"border-secondary-darker";case"danger":return"border-danger-darker";default:return"border-border"}}const U=O(()=>`${E.value} rounded-l-none px-2 w-10 flex items-center justify-center split-button shadow-none focus:ring-0 focus:outline-none active:bg-inherit ${w(m.variant)} ${Z(m.variant)}`),L=O(()=>({xs:"text-xs",m:"text-sm",l:"text-base"})[m.size]),ee=u=>{m.disabled||(v.value?z():W(u))},Y=u=>{m.disabled||M("click",u)},W=u=>{let k;if(P.value?k=P.value.getBoundingClientRect():u&&u.currentTarget&&(k=u.currentTarget.getBoundingClientRect()),k){const V=window.innerWidth,K=window.innerHeight;let C,q=k.bottom+4;m.dropdownAlign==="right"?C=k.right:C=k.left,C<20&&(C=20),C>V-20&&(C=V-20);const X=200;q+X>K&&(q=k.top-X-4,q<20&&(q=k.bottom+4)),b.value={top:q,left:C,buttonWidth:k.width}}v.value=!0},z=()=>{v.value=!1},oe=u=>{M("item-selected",u),z()},te=u=>{if(!u.target)return;const k=u.target;if(k.closest(`[data-dropdown-id="${x.value}"]`))return;const K=k.closest(".dropdown-content");K&&K.dataset.dropdownId===x.value||z()};return ae(()=>{document.addEventListener("click",te),window.addEventListener("scroll",z)}),Be(()=>{document.removeEventListener("click",te),window.removeEventListener("scroll",z)}),(u,k)=>(a(),i("div",{class:"relative inline-flex",ref_key:"splitButtonRef",ref:P},[e("button",{type:"button",class:I(j.value),disabled:u.disabled,title:u.title,onClick:Y,"data-dropdown-id":x.value},[u.buttonIcon?(a(),re(c($),{key:0,icon:u.buttonIcon,class:I([L.value,"mr-1"])},null,8,["icon","class"])):B("",!0),_(" "+g(u.buttonText),1)],10,Re),e("button",{type:"button",class:I(U.value),disabled:u.disabled,"aria-label":"Show dropdown",onClick:ee,"data-dropdown-id":x.value,tabindex:"-1"},[h(c($),{icon:c(Ae),class:I([L.value,"transition-transform duration-200 ease-in-out"]),style:pe({transform:v.value?"rotate(180deg)":"rotate(0deg)"})},null,8,["icon","class","style"])],10,Ge),(a(),re(Te,{to:"body"},[h(Se,{name:"dropdown","enter-active-class":"transition duration-200 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:Q(()=>{var V;return[v.value?(a(),i("div",{key:0,class:"fixed z-50 bg-background border border-border rounded-lg shadow-lg dropdown-content","data-dropdown-id":x.value,style:pe({top:b.value.top+"px",left:m.dropdownAlign==="right"?b.value.left-(((V=y.value)==null?void 0:V.offsetWidth)||0)+"px":b.value.left+"px"}),ref_key:"dropdownRef",ref:y},[e("div",We,[Me(u.$slots,"default",{close:z,handleItemClick:oe},void 0,!0)])],12,He)):B("",!0)]}),_:3})]))],512))}}),Ne=ue(qe,[["__scopeId","data-v-bb23f7eb"]]),Ke={class:"p-4 bg-background space-y-6"},Je={class:"text-lg font-semibold text-text-light mb-4 flex items-center"},Qe={class:"flex items-center space-x-4"},Ye=["disabled"],Xe={key:0,class:"text-text-muted flex items-center"},Ze={class:"text-text-muted mt-2 text-sm flex items-center"},et={class:"flex justify-between items-center mb-4"},tt={class:"text-xl font-semibold text-text-light flex items-center"},st={class:"flex items-center space-x-4"},ot={class:"text-sm text-text-muted"},lt={class:"relative"},nt={class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-text-light-muted"},at={class:"mb-6"},rt={class:"text-text-muted mb-4 flex items-center"},it={class:"relative min-h-[200px]"},dt={key:0,class:"absolute inset-0 flex items-center justify-center bg-background-soft bg-opacity-75 z-10"},ct={key:1,class:"space-y-4"},ut={class:"flex items-start justify-between"},ft={class:"flex-1"},pt={class:"text-lg font-semibold text-text-light mb-2"},xt={key:0,class:"text-text-muted text-sm mb-3"},gt={class:"mb-4"},ht={class:"flex flex-wrap gap-2"},mt={class:"ml-1"},vt={class:"flex items-center text-sm"},bt={class:"mr-4 text-text-muted"},yt={class:"flex items-center space-x-2 ml-4"},wt=["onClick"],_t=["onClick"],kt={class:"text-text-light text-sm"},$t={class:"text-text-muted text-xs"},Ct={class:"border-t border-border mt-2 pt-2"},Dt=["onClick"],Bt=["onClick"],At=["onClick"],St={key:2,class:"text-center text-text-muted py-6"},Mt={key:0},Tt={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},It={class:"font-medium text-text-light mb-2 flex items-center"},Pt={class:"space-y-2"},jt={class:"text-text-light"},Ft={class:"text-text-light"},Ot={class:"text-text-light"},Ut={key:0},zt={class:"text-text-light"},Et=["href"],Lt={class:"font-medium text-text-light mb-2 flex items-center"},Vt={class:"text-text-light"},Rt={class:"mb-6"},Gt={class:"font-medium text-text-light mb-3 flex items-center"},Ht={key:0,class:"flex flex-wrap gap-2"},Wt={key:1,class:"text-text-muted"},qt={class:"font-medium text-text-light mb-3 flex items-center"},Nt={key:0,class:"space-y-2"},Kt={class:"px-2 pb-2"},Jt={key:0,class:"text-text-muted mb-3 mt-2"},Qt={key:1},Yt={class:"grid grid-cols-1 gap-2 max-h-60 overflow-y-auto"},Xt={class:"flex-1 min-w-0"},Zt={class:"flex items-center"},es={class:"font-medium text-text-light truncate mr-3"},ts={key:0,class:"inline-flex items-center px-2 py-1 rounded text-xs bg-green-800 text-white",title:"Model is installed on disk"},ss={key:1,class:"inline-flex items-center px-2 py-1 rounded text-xs bg-gray-600 text-white",title:"Model is not installed on disk"},os={class:"text-xs text-text-muted mt-1"},ls={class:"inline-flex items-center mr-3"},ns={key:0,class:"inline-flex items-center"},as={key:2,class:"text-text-muted text-sm"},rs={key:1,class:"text-text-muted"},is=ce({__name:"DownloadBundlesComponent",setup(ie){const{success:S,error:m,confirm:M}=Ce(),v=ye(),b=A(""),x=A(!1),y=A([]),P=A([]),E=A({}),j=A(!1),w=A(null),Z=A(new Set);A(new Map);const U=async()=>{var n,s;try{const o=await se.get("/bundles/");y.value=o.data||[]}catch(o){m("Failed to load uploaded bundles: "+(((s=(n=o.response)==null?void 0:n.data)==null?void 0:s.message)||o.message))}},L=async()=>{var n,s;try{const o=await se.get("/bundles/installed/");P.value=o.data||[]}catch(o){m("Failed to load installed bundles: "+(((s=(n=o.response)==null?void 0:n.data)==null?void 0:s.message)||o.message))}},ee=async()=>{var n,s;try{const o=await se.get("/models/");E.value=o.data||{}}catch(o){m("Failed to load models data: "+(((s=(n=o.response)==null?void 0:n.data)==null?void 0:s.message)||o.message))}},Y=n=>{const s=E.value.groups||{};for(const o in s){const f=s[o];for(const p of f)if(p.dest===n.dest&&n.dest||p.url===n.url&&n.url)return p.exists||!1}return!1},W=(n,s=null)=>P.value.some(o=>o.id===n&&(!s||o.profile===s)),z=async n=>{var s,o;x.value=!0;try{const f=new FormData;f.append("bundle_file",n),await se.post("/bundles/upload/",f,{headers:{"Content-Type":"multipart/form-data"}}),S(`Bundle "${n.name}" uploaded successfully`),await U()}catch(f){m("Failed to upload bundle: "+(((o=(s=f.response)==null?void 0:s.data)==null?void 0:o.detail)||f.message))}finally{x.value=!1}},oe=async n=>{var f;const s=n.target,o=(f=s.files)==null?void 0:f[0];o&&(await z(o),s.value="")},te=()=>{const n=document.getElementById("bundle-upload-file");n==null||n.click()},u=n=>{const s=Object.keys(n.hardware_profiles||{}),o=s.filter(f=>W(n.id,f));return o.length===0?{status:"not-installed",text:"Not Installed"}:o.length===s.length?{status:"fully-installed",text:"Fully Installed"}:{status:"partially-installed",text:`Partially Installed (${o.length}/${s.length})`}},k=async n=>{var s,o;try{if(await M(`Are you sure you want to uninstall bundle "${n.name}"?`,"Confirm Uninstall")){x.value=!0;const p=Object.keys(n.hardware_profiles||{});for(const t of p)W(n.id,t)&&await se.post("/bundles/uninstall",{bundle_id:n.id,profile:t});S(`Bundle "${n.name}" uninstalled successfully`),await L()}}catch(f){m("Failed to uninstall bundle: "+(((o=(s=f.response)==null?void 0:s.data)==null?void 0:o.detail)||f.message))}finally{x.value=!1}},V=async n=>{var s,o;try{await M(`Are you sure you want to delete the uploaded bundle "${n.name}"? This will remove it from the server permanently.`,"Confirm Delete")&&(x.value=!0,await se.delete(`/bundles/${n.id}`),S(`Bundle "${n.name}" deleted successfully`),await U(),await L())}catch(f){m("Failed to delete bundle: "+(((o=(s=f.response)==null?void 0:s.data)==null?void 0:o.detail)||f.message))}finally{x.value=!1}},K=n=>{w.value=n,j.value=!0},C=()=>{j.value=!1,w.value=null,Z.value.clear()},q=n=>n.dest?n.dest.split("/").pop()||"Unknown model":n.url&&n.url.split("/").pop()||"Unknown model",X=O(()=>{if(!b.value)return y.value;const n=b.value.toLowerCase();return y.value.filter(s=>s.name.toLowerCase().includes(n)||s.description&&s.description.toLowerCase().includes(n)||s.workflows&&s.workflows.some(o=>o.toLowerCase().includes(n)))});ae(async()=>{await Promise.all([U(),L(),ee()])});const R=n=>Object.keys(n.hardware_profiles||{}).filter(o=>!W(n.id,o)),J=n=>Object.keys(n.hardware_profiles||{}).filter(o=>W(n.id,o)),N=(n,s)=>{var t;const o=(t=n.hardware_profiles)==null?void 0:t[s];if(!o||!o.models)return{installed:0,total:0};const f=o.models.length;return{installed:o.models.filter(l=>Y(l)).length,total:f}},de=(n,s)=>{s==="install-all"?fe(n):le(n,[s])},le=async(n,s)=>{var o,f;try{if(!s||s.length===0){m("Please select at least one profile to install");return}await v.startBundleInstallation(n.id,n.name,s),setTimeout(async()=>{await L()},2e3),S(`Started installation of ${s.length} profile(s) for bundle "${n.name}"`)}catch(p){m("Failed to start profile installation: "+(((f=(o=p.response)==null?void 0:o.data)==null?void 0:f.detail)||p.message))}},fe=async n=>{const s=R(n);if(s.length===0){S(`Bundle "${n.name}" is already fully installed`);return}await le(n,s)};return ae(async()=>{await Promise.all([U(),L(),ee()])}),(n,s)=>(a(),i("div",Ke,[h(be,null,{default:Q(()=>[e("h3",Je,[h(c($),{icon:c(xe),class:"mr-2"},null,8,["icon"]),s[1]||(s[1]=_(" Upload Bundle "))]),e("div",Qe,[e("input",{type:"file",class:"hidden",id:"bundle-upload-file",onChange:oe,accept:".json"},null,32),e("button",{class:"btn btn-primary",onClick:te,disabled:x.value},[h(c($),{icon:c(xe),class:"mr-1"},null,8,["icon"]),s[2]||(s[2]=_("Upload Bundle File "))],8,Ye),x.value?(a(),i("div",Xe,[h(c($),{icon:c(Ie),class:"animate-spin mr-1"},null,8,["icon"]),s[3]||(s[3]=_(" Processing... "))])):B("",!0)]),e("p",Ze,[h(c($),{icon:c(ne),class:"mr-1"},null,8,["icon"]),s[4]||(s[4]=_(" Upload a JSON bundle file to add it to your collection. You can then install or manage it below. "))])]),_:1}),h(be,null,{default:Q(()=>[e("div",et,[e("h2",tt,[h(c($),{icon:c(we),class:"mr-2"},null,8,["icon"]),s[5]||(s[5]=_(" Uploaded Bundles "))]),e("div",st,[e("div",ot,g(y.value.length)+" bundle"+g(y.value.length!==1?"s":"")+" uploaded ",1),e("div",lt,[_e(e("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>b.value=o),type:"text",placeholder:"Search bundles",class:"form-input pl-10"},null,512),[[ke,b.value]]),e("span",nt,[h(c($),{icon:c(Pe)},null,8,["icon"])])])])]),e("div",at,[e("p",rt,[h(c($),{icon:c(ne),class:"mr-2"},null,8,["icon"]),s[6]||(s[6]=_(" Manage your uploaded bundles: view details, install/uninstall, or delete them. "))]),e("div",it,[x.value?(a(),i("div",dt,s[7]||(s[7]=[e("div",{class:"flex flex-col items-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"}),e("span",{class:"mt-2 text-text-light"},"Processing...")],-1)]))):B("",!0),X.value.length>0?(a(),i("div",ct,[(a(!0),i(G,null,H(X.value,o=>(a(),i("div",{key:o.id,class:"bg-background-soft border border-border rounded-lg p-6 hover:shadow-md transition-shadow"},[e("div",ut,[e("div",ft,[e("h4",pt,g(o.name),1),o.description?(a(),i("p",xt,g(o.description),1)):B("",!0),e("div",gt,[s[8]||(s[8]=e("h5",{class:"text-sm font-medium text-text-light mb-2"}," Hardware Profiles: ",-1)),e("div",ht,[(a(!0),i(G,null,H(o.hardware_profiles,(f,p)=>(a(),i("span",{key:p,class:I(["inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border",N(o,p).installed===N(o,p).total&&N(o,p).total>0?"bg-green-100 text-green-800 border-green-200":N(o,p).installed>0?"bg-yellow-100 text-yellow-800 border-yellow-200":"bg-blue-100 text-blue-800 border-blue-200"])},[h(c($),{icon:c(ge),class:"mr-1"},null,8,["icon"]),_(" "+g(p)+" ",1),e("span",mt," ("+g(N(o,p).installed)+"/"+g(N(o,p).total)+") ",1)],2))),128))])]),e("div",vt,[e("span",bt,[s[9]||(s[9]=_(" Status: ")),e("span",{class:I(["font-medium",u(o).color])},g(u(o).text),3)])])]),e("div",yt,[e("button",{onClick:f=>K(o),class:"btn btn-secondary-outline text-sm h-8",title:"View bundle details"},[h(c($),{icon:c(ne),class:"mr-1"},null,8,["icon"]),s[10]||(s[10]=_(" Details "))],8,wt),R(o).length>0?(a(),re(Ne,{key:0,"button-text":"Install","button-icon":c(je),size:"xs",variant:"primary",title:"Install bundle profiles","dropdown-width":250,align:"left",onItemSelected:f=>de(o,f)},{default:Q(({handleItemClick:f})=>[s[11]||(s[11]=e("div",{class:"text-sm font-medium text-text-light mb-2"}," Select profiles to install: ",-1)),(a(!0),i(G,null,H(R(o),p=>{var t,l,d;return a(),i("div",{key:p,class:"flex items-center justify-between p-2 hover:bg-background-soft rounded cursor-pointer",onClick:D=>f(p)},[e("span",kt,g(p),1),e("span",$t,g(((d=(l=(t=o.hardware_profiles)==null?void 0:t[p])==null?void 0:l.models)==null?void 0:d.length)||0)+" models ",1)],8,_t)}),128)),e("div",Ct,[e("div",{class:"w-full text-left p-2 text-sm text-primary hover:bg-background-soft rounded cursor-pointer",onClick:p=>f("install-all")}," Install All Profiles ",8,Dt)])]),_:2},1032,["button-icon","onItemSelected"])):B("",!0),J(o).length>0?(a(),i("button",{key:1,onClick:f=>k(o),class:"btn btn-danger text-sm h-8",title:"Uninstall bundle"},[h(c($),{icon:c(he),class:"mr-1"},null,8,["icon"]),s[12]||(s[12]=_(" Uninstall "))],8,Bt)):B("",!0),e("button",{onClick:f=>V(o),class:"btn btn-danger text-sm h-8",title:"Delete bundle file"},[h(c($),{icon:c(he)},null,8,["icon"])],8,At)])])]))),128))])):(a(),i("div",St," No bundles found. "))])])]),_:1}),h(Ve,{show:j.value,onClose:C},{title:Q(()=>{var o;return[_(" Bundle Details: "+g((o=w.value)==null?void 0:o.name),1)]}),default:Q(()=>{var o,f;return[w.value?(a(),i("div",Mt,[e("div",Tt,[e("div",null,[e("h4",It,[h(c($),{icon:c(ne),class:"mr-2"},null,8,["icon"]),s[13]||(s[13]=_("Basic Information "))]),e("dl",Pt,[e("div",null,[s[14]||(s[14]=e("dt",{class:"text-sm text-text-muted"},"Name:",-1)),e("dd",jt,g(w.value.name),1)]),e("div",null,[s[15]||(s[15]=e("dt",{class:"text-sm text-text-muted"},"Version:",-1)),e("dd",Ft,g(w.value.version||"1.0.0"),1)]),e("div",null,[s[16]||(s[16]=e("dt",{class:"text-sm text-text-muted"},"Author:",-1)),e("dd",Ot,g(w.value.author||"N/A"),1)]),w.value.website?(a(),i("div",Ut,[s[17]||(s[17]=e("dt",{class:"text-sm text-text-muted"},"Website:",-1)),e("dd",zt,[e("a",{href:w.value.website,target:"_blank",class:"text-primary hover:underline"},g(w.value.website),9,Et)])])):B("",!0)])]),e("div",null,[e("h4",Lt,[h(c($),{icon:c(ne),class:"mr-2"},null,8,["icon"]),s[18]||(s[18]=_("Description "))]),e("p",Vt,g(w.value.description),1)])]),e("div",Rt,[e("h4",Gt,[h(c($),{icon:c(me),class:"mr-2"},null,8,["icon"]),_("Workflows ("+g(((o=w.value.workflows)==null?void 0:o.length)||0)+") ",1)]),((f=w.value.workflows)==null?void 0:f.length)>0?(a(),i("div",Ht,[(a(!0),i(G,null,H(w.value.workflows,p=>(a(),i("span",{key:p,class:"inline-flex items-center px-3 py-1 rounded text-sm bg-blue-600 text-white"},[h(c($),{icon:c(me),class:"mr-1"},null,8,["icon"]),_(g(p),1)]))),128))])):(a(),i("p",Wt,"No workflows defined."))]),e("div",null,[e("h4",qt,[h(c($),{icon:c(ge),class:"mr-2"},null,8,["icon"]),_("Hardware Profiles ("+g(Object.keys(w.value.hardware_profiles||{}).length)+") ",1)]),Object.keys(w.value.hardware_profiles||{}).length>0?(a(),i("div",Nt,[(a(!0),i(G,null,H(w.value.hardware_profiles,(p,t)=>{var l;return a(),re(De,{key:t,title:t+" ("+(((l=p.models)==null?void 0:l.length)||0)+" models)",icon:"server",size:"xs"},{default:Q(()=>[e("div",Kt,[p.description?(a(),i("p",Jt,g(p.description),1)):B("",!0),p.models&&p.models.length>0?(a(),i("div",Qt,[s[21]||(s[21]=e("h6",{class:"text-sm font-medium text-text-light mb-2"}," Models: ",-1)),e("div",Yt,[(a(!0),i(G,null,H(p.models,(d,D)=>(a(),i("div",{key:D,class:"flex items-center justify-between p-3 bg-background rounded border text-sm"},[e("div",Xt,[e("div",Zt,[e("div",es,g(q(d)),1),Y(d)?(a(),i("span",ts,[h(c($),{icon:c(Fe),class:"mr-1"},null,8,["icon"]),s[19]||(s[19]=_(" Installed "))])):(a(),i("span",ss,[h(c($),{icon:c(Oe),class:"mr-1"},null,8,["icon"]),s[20]||(s[20]=_(" Not Installed "))]))]),e("div",os,[e("span",ls,[h(c($),{icon:c($e),class:"mr-1"},null,8,["icon"]),_(g(d.type),1)]),d.tags&&d.tags.length>0?(a(),i("span",ns," Tags: "+g(d.tags.join(", ")),1)):B("",!0)])])]))),128))])])):(a(),i("div",as," No models in this profile. "))])]),_:2},1032,["title"])}),128))])):(a(),i("p",rs,"No hardware profiles defined."))])])):B("",!0)]}),_:1},8,["show"])]))}}),ds=ue(is,[["__scopeId","data-v-41800b41"]]),cs={class:"download-models-container w-full p-4 space-y-4"},us={class:"models-card bg-background-soft border border-border rounded-lg shadow-md"},fs={class:"flex items-center justify-between p-4 border-b border-border"},ps={class:"header-actions flex gap-2"},xs=["disabled"],gs=["disabled"],hs={class:"p-4 space-y-4"},ms={class:"filter-section bg-background-mute border border-border rounded-lg p-4 space-y-3"},vs={class:"flex items-center gap-2 mb-2"},bs={class:"relative"},ys={key:0,class:"space-y-2"},ws={class:"flex flex-wrap gap-2"},_s=["onClick"],ks={key:0,class:"ml-1"},$s={key:1,class:"text-xs text-text-light-muted"},Cs={key:0},Ds={key:1},Bs={key:0,class:"text-center text-text-light-muted py-8"},As={key:1,class:"space-y-4"},Ss={class:"table-responsive"},Ms={class:"overflow-x-auto"},Ts={class:"w-full text-sm"},Is={class:"bg-background-mute"},Ps={class:"p-2 text-left"},js=["checked","onChange","disabled"],Fs={class:"p-2"},Os=["checked","onChange","disabled"],Us={class:"p-2"},zs={class:"p-2"},Es={key:0,class:"flex flex-wrap gap-1"},Ls={key:1,class:"text-text-light-muted"},Vs={class:"p-2 text-text-light"},Rs={class:"p-2 text-text-light"},Gs={class:"p-2"},Hs=["href"],Ws={key:1,class:"text-text-light-muted"},qs={class:"p-2"},Ns={class:"p-2"},Ks={class:"flex gap-2"},Js=["onClick","disabled"],Qs=["onClick","disabled"],Ys={name:"DownloadModelsComponent"},Xs=ce({...Ys,setup(ie){const S=ye(),{models:m,rawDownloads:M}=Ue(S),v=A({}),b=A({}),x=A(""),y=A([]),{showNotification:P,showDialog:E}=Ce(),j=M,w=async()=>{try{await S.fetchModels(),v.value={...v.value}}catch{}};let Z={};ve(()=>{for(const t in Z)if(!(t in j.value)||j.value[t]&&j.value[t].progress===100){w();break}Z={...j.value}});const U=A([]),L=(t,l)=>{const d=U.value.indexOf(t);l&&d===-1?U.value.push(t):!l&&d>-1&&U.value.splice(d,1)},ee=(t,l)=>{const d=u(t);l?v.value[d]=!0:delete v.value[d],v.value={...v.value}},Y=O(()=>{const t=new Set;return m.value.forEach(l=>{l.tags&&(Array.isArray(l.tags)?l.tags.forEach(d=>t.add(d)):t.add(l.tags))}),Array.from(t).sort()}),W=O(()=>{let t=m.value;if(x.value.trim()){const l=x.value.toLowerCase().trim();t=t.filter(d=>{const D=(k(d.dest)||d.git||"").toLowerCase(),r=d.tags?(Array.isArray(d.tags)?d.tags.join(" "):d.tags).toLowerCase():"";return D.includes(l)||r.includes(l)})}return y.value.length>0&&(t=t.filter(l=>{if(!l.tags)return!1;const d=Array.isArray(l.tags)?l.tags:[l.tags];return y.value.every(D=>d.some(r=>r.toLowerCase()===D.toLowerCase()))})),t}),z=O(()=>{const t={};W.value.forEach(r=>{const T=r.group||"Other";t[T]||(t[T]=[]),t[T].push(r)});const l={},d=b.value.group_order||[];return d.forEach(r=>{t[r]&&(l[r]=t[r])}),Object.keys(t).filter(r=>!d.includes(r)).sort().forEach(r=>{l[r]=t[r]}),l}),oe=t=>{const l=y.value.indexOf(t);l>-1?y.value.splice(l,1):y.value.push(t)},te=()=>{x.value="",y.value=[]},u=t=>t.url||t.git||"",k=t=>(t==null?void 0:t.split("/").pop())||"",V=t=>t?t>1e9?(t/1e9).toFixed(2)+" GB":t>1e6?(t/1e6).toFixed(2)+" MB":t>1e3?(t/1e3).toFixed(2)+" KB":t+" B":"-",K=t=>{const l=t.tags;return l?Array.isArray(l)?l.includes("nsfw"):l==="nsfw":!1},C=t=>!!j.value[u(t)],q=t=>t.filter(l=>!C(l)).every(l=>v.value[u(l)]),X=(t,l)=>{for(const d of t)C(d)||(v.value[u(d)]=l)},R=O(()=>m.value.filter(t=>v.value[u(t)]&&t.exists)),J=O(()=>m.value.filter(t=>v.value[u(t)]&&!t.exists&&!j.value[u(t)]));ve(()=>{console.log("selectedToDelete:",R.value.map(t=>u(t))),console.log("selectedToDownload:",J.value.map(t=>u(t)))});const N=O(()=>R.value.length>0),de=O(()=>J.value.length>0);function le(t){const l=Array.isArray(t)?t:[t];for(const d of l)delete v.value[u(d)];v.value={...v.value}}const fe=async()=>{if(!R.value.length)return;await E({title:"Delete selected models",message:`Are you sure you want to delete ${R.value.length} model(s)?`,type:"confirm",confirmText:"Delete",cancelText:"Cancel"})&&(await s(R.value),le(R.value))},n=async()=>{if(!J.value.length)return;await E({title:"Download selected models",message:`Download ${J.value.length} model(s)?`,type:"confirm",confirmText:"Download",cancelText:"Cancel"})&&(await o(J.value),le(J.value))};async function s(t){try{const l=await S.deleteModels(t);let D=(Array.isArray(l)?l:[l]).filter(r=>r&&r.ok===!1);D.length?D.forEach(r=>P(r.msg||"Delete failed","error")):P(Array.isArray(t)&&t.length>1?"Selected models deleted":"Model deleted","success"),await w()}catch{P("Delete operation failed","error")}}async function o(t){try{const d=(Array.isArray(t)?t:[t]).filter(F=>C(F));if(d.length>0){P(`Some models are already downloading: ${d.map(F=>k(F.dest)||F.git).join(", ")}`,"warning");return}S.startGlobalDownloadPolling();const D=await S.startDownload(t);let T=(Array.isArray(D)?D:[D]).filter(F=>F&&F.ok===!1);T.length?T.forEach(F=>P(F.msg||"Download failed","error")):(P(Array.isArray(t)&&t.length>1?"Selected models downloading":"Download started","success"),setTimeout(async()=>{await S.refreshDownloads(),console.log("Downloads refreshed after POST, current downloads:",Object.keys(M.value))},1e3)),await w()}catch{P("Download operation failed","error")}}const f=async t=>{if(C(t)){P(`Model "${k(t.dest)||t.git}" is already downloading`,"warning");return}await E({title:"Download model",message:`Download model "${k(t.dest)||t.git}"?`,type:"confirm",confirmText:"Download",cancelText:"Cancel"})&&await o(t)},p=async t=>{await E({title:"Delete model",message:`Delete model "${k(t.dest)||t.git}"?`,type:"confirm",confirmText:"Delete",cancelText:"Cancel"})&&await s(t)};return ae(async()=>{await w(),await S.refreshDownloads(),S.startGlobalDownloadPolling()}),(t,l)=>(a(),i("div",cs,[e("div",us,[e("div",fs,[l[1]||(l[1]=e("div",{class:"flex items-center gap-2"},[e("svg",{class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"})]),e("span",{class:"text-lg font-bold text-white"},"Model Manager")],-1)),e("div",ps,[e("button",{disabled:!N.value,onClick:fe,class:I(["px-4 py-2 rounded text-sm font-medium transition-colors",N.value?"bg-red-600 hover:bg-red-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"])}," Delete selected ",10,xs),e("button",{disabled:!de.value,onClick:n,class:I(["px-4 py-2 rounded text-sm font-medium transition-colors",de.value?"bg-primary hover:bg-primary-dark text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"])}," Download selected ",10,gs)])]),e("div",hs,[e("div",ms,[e("div",vs,[l[2]||(l[2]=e("svg",{class:"w-5 h-5 text-text-light",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.414A1 1 0 013 6.707V4z"})],-1)),l[3]||(l[3]=e("span",{class:"font-medium text-text-light"},"Filters",-1)),x.value||y.value.length>0?(a(),i("button",{key:0,onClick:te,class:"ml-auto px-2 py-1 text-xs bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors"}," Clear All ")):B("",!0)]),e("div",bs,[_e(e("input",{"onUpdate:modelValue":l[0]||(l[0]=d=>x.value=d),type:"text",placeholder:"Search by name or tags...",class:"w-full px-3 py-2 pl-10 bg-background border border-border rounded-md text-text-light placeholder-text-light-muted focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[ke,x.value]]),l[4]||(l[4]=e("svg",{class:"absolute left-3 top-2.5 w-4 h-4 text-text-light-muted",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),Y.value.length>0?(a(),i("div",ys,[l[5]||(l[5]=e("span",{class:"text-sm font-medium text-text-light"},"Filter by tags:",-1)),e("div",ws,[(a(!0),i(G,null,H(Y.value,d=>(a(),i("button",{key:d,onClick:D=>oe(d),class:I(["px-3 py-1 text-xs rounded-full border transition-colors",y.value.includes(d)?"bg-primary text-white border-primary":"bg-background border-border text-text-light hover:bg-background-mute"])},[_(g(d)+" ",1),y.value.includes(d)?(a(),i("span",ks,"×")):B("",!0)],10,_s))),128))])])):B("",!0),x.value||y.value.length>0?(a(),i("div",$s,[_(" Showing "+g(W.value.length)+" of "+g(c(m).length)+" models ",1),x.value?(a(),i("span",Cs,' matching "'+g(x.value)+'"',1)):B("",!0),y.value.length>0?(a(),i("span",Ds," with tags: "+g(y.value.join(", ")),1)):B("",!0)])):B("",!0)]),Object.keys(z.value).length===0?(a(),i("div",Bs,g(x.value||y.value.length>0?"No models match the current filters.":"No models found."),1)):(a(),i("div",As,[(a(!0),i(G,null,H(z.value,(d,D)=>(a(),re(De,{key:D,title:D,size:"xs",defaultOpen:U.value.includes(D),onToggle:r=>L(D,r)},{default:Q(()=>[e("div",Ss,[e("div",Ms,[e("table",Ts,[e("thead",Is,[e("tr",null,[e("th",Ps,[e("input",{type:"checkbox",checked:q(d),onChange:r=>{var T;return X(d,((T=r.target)==null?void 0:T.checked)||!1)},disabled:d.every(r=>C(r)),class:"rounded"},null,40,js)]),l[6]||(l[6]=e("th",{class:"p-2 text-left text-text-light"},"Name",-1)),l[7]||(l[7]=e("th",{class:"p-2 text-left text-text-light"},"Tags",-1)),l[8]||(l[8]=e("th",{class:"p-2 text-left text-text-light"},"Type",-1)),l[9]||(l[9]=e("th",{class:"p-2 text-left text-text-light"},"Size",-1)),l[10]||(l[10]=e("th",{class:"p-2 text-left text-text-light"},"Source",-1)),l[11]||(l[11]=e("th",{class:"p-2 text-left text-text-light"},"Present",-1)),l[12]||(l[12]=e("th",{class:"p-2 text-left text-text-light"},"Action",-1))])]),e("tbody",null,[(a(!0),i(G,null,H(d,r=>(a(),i("tr",{key:u(r),class:I(["border-b border-border hover:bg-background-mute transition-colors",C(r)?"is-downloading":""])},[e("td",Fs,[e("input",{type:"checkbox",checked:v.value[u(r)]||!1,onChange:T=>{var F;return ee(r,((F=T.target)==null?void 0:F.checked)||!1)},disabled:C(r),class:"rounded"},null,40,Os)]),e("td",Us,[e("span",{class:I(["font-medium",C(r)?"opacity-50":"",K(r)?"text-red-400":"text-text-light"])},g(k(r.dest)||r.git),3)]),e("td",zs,[r.tags&&r.tags.length?(a(),i("div",Es,[(a(!0),i(G,null,H(Array.isArray(r.tags)?r.tags:[r.tags],T=>(a(),i("span",{key:T,class:"px-2 py-1 bg-blue-600 text-white text-xs rounded"},g(T),1))),128))])):(a(),i("span",Ls,"-"))]),e("td",Vs,g(r.type||D),1),e("td",Rs,g(r.size?V(r.size):"-"),1),e("td",Gs,[r.src?(a(),i("a",{key:0,href:r.src,target:"_blank",rel:"noopener",class:"text-primary hover:text-primary-light underline"}," Link ",8,Hs)):(a(),i("span",Ws,"-"))]),e("td",qs,[e("span",{class:I(["px-2 py-1 text-xs rounded",r.exists?"bg-green-600 text-white":"bg-red-600 text-white"])},g(r.exists?"Yes":"No"),3)]),e("td",Ns,[e("div",Ks,[r.exists?B("",!0):(a(),i("button",{key:0,onClick:T=>f(r),disabled:C(r),class:I(["px-3 py-1 rounded text-sm transition-colors",C(r)?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-primary hover:bg-primary-dark text-white"])}," Download ",10,Js)),r.exists?(a(),i("button",{key:1,onClick:T=>p(r),disabled:C(r),class:I(["px-3 py-1 rounded text-sm transition-colors",C(r)?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700 text-white"])}," Delete ",10,Qs)):B("",!0)])])],2))),128))])])])])]),_:2},1032,["title","defaultOpen","onToggle"]))),128))]))])])]))}}),Zs=ue(Xs,[["__scopeId","data-v-eaa7b637"]]),eo={class:"install-page p-4 bg-background min-h-screen"},to={class:"bg-background-soft border border-border rounded-lg"},so={class:"border-b border-border"},oo={class:"flex space-x-0","aria-label":"Tabs"},lo={class:"tab-content"},no={key:0,class:"tab-pane"},ao={key:1,class:"tab-pane"},ro=ce({__name:"InstallPage",setup(ie){const S=ze(),m=Ee(),M=A("bundles");ae(()=>{const b=S.query.tab;(b==="models"||b==="bundles")&&(M.value=b)}),Le(()=>S.query.tab,b=>{typeof b=="string"&&(b==="models"||b==="bundles")&&(M.value=b)});const v=b=>{M.value=b,m.push({name:"install",query:{tab:b}})};return(b,x)=>(a(),i("div",eo,[e("div",to,[e("div",so,[e("nav",oo,[e("button",{onClick:x[0]||(x[0]=y=>v("bundles")),class:I(["px-6 py-4 text-sm font-medium border-b-2 transition-colors duration-200",M.value==="bundles"?"border-primary text-primary bg-primary bg-opacity-10":"border-transparent text-text-muted hover:text-text-light hover:border-border"])},[h(c($),{icon:c(we),class:"mr-2"},null,8,["icon"]),x[2]||(x[2]=_(" Install Bundles "))],2),e("button",{onClick:x[1]||(x[1]=y=>v("models")),class:I(["px-6 py-4 text-sm font-medium border-b-2 transition-colors duration-200",M.value==="models"?"border-primary text-primary bg-primary bg-opacity-10":"border-transparent text-text-muted hover:text-text-light hover:border-border"])},[h(c($),{icon:c($e),class:"mr-2"},null,8,["icon"]),x[3]||(x[3]=_(" Install Models "))],2)])]),e("div",lo,[M.value==="bundles"?(a(),i("div",no,[h(ds)])):B("",!0),M.value==="models"?(a(),i("div",ao,[h(Zs)])):B("",!0)])])]))}}),fo=ue(ro,[["__scopeId","data-v-1b47691e"]]);export{fo as default};
