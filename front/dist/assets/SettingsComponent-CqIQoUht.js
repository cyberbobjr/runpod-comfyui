import{_ as P,c as h,b as e,a as x,j as n,S as v,n as F,t as p,w as b,s as w,o as d,U as y,d as a,A as m,B as k,i as u,$ as c}from"./index--V_irXaw.js";import{A as C}from"./AccordionComponent-D2oGAy0i.js";const _={name:"SettingsComponent",components:{AccordionComponent:C},data(){return{baseDirForm:{base_dir:""},baseDirSource:"",baseDirLoading:!1,tokensForm:{hf_token:"",civitai_token:""},tokensLoading:!1,showHfToken:!1,showCivitaiToken:!1,passwordForm:{oldUsername:"",oldPassword:"",newUsername:"",newPassword:""},confirmPassword:"",passwordLoading:!1,message:"",messageType:"info",showCurrentPassword:!1,showNewPassword:!1,showConfirmPassword:!1}},computed:{passwordsMatch(){return this.passwordForm.newPassword===this.confirmPassword},isPasswordFormValid(){return this.passwordForm.oldUsername.trim()&&this.passwordForm.oldPassword&&this.passwordForm.newUsername.trim()&&this.passwordForm.newPassword.length>=4&&this.passwordsMatch},messageClass(){const i="border-l-4";switch(this.messageType){case"success":return`${i} border-green-500 bg-green-900/20 text-green-300`;case"error":return`${i} border-red-500 bg-red-900/20 text-red-300`;case"warning":return`${i} border-yellow-500 bg-yellow-900/20 text-yellow-300`;default:return`${i} border-secondary bg-blue-900/20 text-secondary`}},messageIcon(){switch(this.messageType){case"success":return"check-circle";case"error":return"exclamation-circle";case"warning":return"exclamation-triangle";default:return"info-circle"}}},async mounted(){await this.loadConfig()},methods:{async loadConfig(){try{const i=await w.get("/jsonmodels/config");this.baseDirForm.base_dir=i.data.BASE_DIR,this.baseDirSource=i.data.source;const s=await w.get("/models/tokens");this.tokensForm.hf_token=s.data.hf_token||"",this.tokensForm.civitai_token=s.data.civitai_token||""}catch(i){console.error("Error loading config:",i),this.showMessage("Failed to load configuration.","error")}},async updateBaseDir(){if(this.baseDirForm.base_dir.trim()){this.baseDirLoading=!0,this.message="";try{await w.post("/jsonmodels/config",{base_dir:this.baseDirForm.base_dir}),this.showMessage("Base directory updated successfully!","success"),await this.loadConfig()}catch(i){console.error("Error updating base directory:",i),this.showMessage("Failed to update base directory. Please try again.","error")}finally{this.baseDirLoading=!1}}},async updateTokens(){this.tokensLoading=!0,this.message="";try{await w.post("/models/tokens",{hf_token:this.tokensForm.hf_token||null,civitai_token:this.tokensForm.civitai_token||null}),this.showMessage("API tokens updated successfully!","success")}catch(i){console.error("Error updating tokens:",i),this.showMessage("Failed to update API tokens. Please try again.","error")}finally{this.tokensLoading=!1}},resetTokensForm(){this.tokensForm={hf_token:"",civitai_token:""},this.showHfToken=!1,this.showCivitaiToken=!1},async changePassword(){var i,s;if(this.isPasswordFormValid){this.passwordLoading=!0,this.message="";try{await w.post("/models/change_user",{old_username:this.passwordForm.oldUsername,old_password:this.passwordForm.oldPassword,new_username:this.passwordForm.newUsername,new_password:this.passwordForm.newPassword}),this.showMessage("Password changed successfully! Please log in again with your new credentials.","success"),this.resetPasswordForm(),setTimeout(()=>{localStorage.removeItem("auth_token"),this.$router.push({name:"login"})},2e3)}catch(g){console.error("Error changing password:",g),((i=g.response)==null?void 0:i.status)===401?this.showMessage("Invalid current username or password.","error"):((s=g.response)==null?void 0:s.status)===409?this.showMessage("Username already exists. Please choose a different username.","error"):this.showMessage("Failed to change password. Please try again.","error")}finally{this.passwordLoading=!1}}},resetPasswordForm(){this.passwordForm={oldUsername:"",oldPassword:"",newUsername:"",newPassword:""},this.confirmPassword="",this.showCurrentPassword=!1,this.showNewPassword=!1,this.showConfirmPassword=!1},showMessage(i,s="info"){this.message=i,this.messageType=s}}},T={class:"space-y-6 p-4 bg-background"},U={class:"card"},D={class:"flex items-center gap-3 mb-6"},A={class:"form-label"},I={class:"text-sm text-text-muted mt-1"},L=["disabled"],M={class:"form-label"},S={class:"relative"},V=["type"],B={class:"form-label"},N={class:"relative"},E=["type"],q={class:"flex gap-4"},H=["disabled"],R={class:"form-label"},j={class:"form-label"},z={class:"relative"},Y=["type"],G={class:"form-label"},J={class:"form-label"},K={class:"relative"},O=["type"],Q={class:"form-label"},W={class:"relative"},X=["type"],Z={key:0,class:"text-sm text-red-400 mt-1"},$={class:"flex gap-4"},ss=["disabled"],es={class:"mt-8 p-4 bg-background-mute rounded-lg"},os={class:"font-semibold text-text-light mb-2 flex items-center gap-2"};function ts(i,s,g,rs,o,l){const r=v("FontAwesomeIcon"),f=v("AccordionComponent");return d(),h("div",T,[e("div",U,[e("div",D,[n(r,{icon:"cog",class:"text-primary text-2xl"}),s[18]||(s[18]=e("h1",{class:"text-2xl font-bold text-heading"},"Settings",-1))]),o.message?(d(),h("div",{key:0,class:F([l.messageClass,"p-4 rounded-lg mb-6 flex items-center gap-2"])},[n(r,{icon:l.messageIcon},null,8,["icon"]),e("span",null,p(o.message),1)],2)):x("",!0),n(f,{title:"Base Directory Configuration",icon:"folder","default-open":!0,class:"mb-4"},{default:b(()=>[e("form",{onSubmit:s[1]||(s[1]=y((...t)=>l.updateBaseDir&&l.updateBaseDir(...t),["prevent"])),class:"space-y-4"},[e("div",null,[e("label",A,[n(r,{icon:"folder-open",class:"mr-2"}),s[19]||(s[19]=a(" BASE_DIR "))]),m(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>o.baseDirForm.base_dir=t),type:"text",class:"form-input",placeholder:"Enter base directory path",required:""},null,512),[[k,o.baseDirForm.base_dir]]),e("p",I," Current source: "+p(o.baseDirSource),1)]),s[20]||(s[20]=a()),e("button",{type:"submit",disabled:o.baseDirLoading,class:"btn btn-primary disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[o.baseDirLoading?(d(),u(r,{key:0,icon:"spinner",class:"animate-spin"})):(d(),u(r,{key:1,icon:"save"})),a(" "+p(o.baseDirLoading?"Updating...":"Update Base Directory"),1)],8,L)],32)]),_:1}),n(f,{title:"API Tokens Configuration",icon:"key","default-open":!1,class:"mb-4"},{default:b(()=>[e("form",{onSubmit:s[7]||(s[7]=y((...t)=>l.updateTokens&&l.updateTokens(...t),["prevent"])),class:"space-y-4"},[e("div",null,[e("label",M,[n(r,{icon:"cloud",class:"mr-2"}),s[21]||(s[21]=a(" HuggingFace Token "))]),e("div",S,[m(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>o.tokensForm.hf_token=t),type:o.showHfToken?"text":"password",class:"form-input pr-12",placeholder:"Enter your HuggingFace token (optional)"},null,8,V),[[c,o.tokensForm.hf_token]]),e("button",{type:"button",onClick:s[3]||(s[3]=t=>o.showHfToken=!o.showHfToken),class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-muted hover:text-text-light"},[n(r,{icon:o.showHfToken?"eye-slash":"eye"},null,8,["icon"])])]),s[22]||(s[22]=e("p",{class:"text-sm text-text-muted mt-1"}," Required for downloading models from HuggingFace ",-1))]),e("div",null,[e("label",B,[n(r,{icon:"download",class:"mr-2"}),s[23]||(s[23]=a(" CivitAI Token "))]),e("div",N,[m(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>o.tokensForm.civitai_token=t),type:o.showCivitaiToken?"text":"password",class:"form-input pr-12",placeholder:"Enter your CivitAI token (optional)"},null,8,E),[[c,o.tokensForm.civitai_token]]),e("button",{type:"button",onClick:s[5]||(s[5]=t=>o.showCivitaiToken=!o.showCivitaiToken),class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-muted hover:text-text-light"},[n(r,{icon:o.showCivitaiToken?"eye-slash":"eye"},null,8,["icon"])])]),s[24]||(s[24]=e("p",{class:"text-sm text-text-muted mt-1"}," Required for downloading models from CivitAI ",-1))]),e("div",q,[e("button",{type:"submit",disabled:o.tokensLoading,class:"btn btn-primary disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[o.tokensLoading?(d(),u(r,{key:0,icon:"spinner",class:"animate-spin"})):(d(),u(r,{key:1,icon:"save"})),a(" "+p(o.tokensLoading?"Updating...":"Update Tokens"),1)],8,H),e("button",{type:"button",onClick:s[6]||(s[6]=(...t)=>l.resetTokensForm&&l.resetTokensForm(...t)),class:"btn btn-primary flex items-center gap-2"},[n(r,{icon:"undo"}),s[25]||(s[25]=a(" Reset "))])])],32)]),_:1}),n(f,{title:"Change Password",icon:"key","default-open":!1,class:"mb-4"},{default:b(()=>[e("form",{onSubmit:s[17]||(s[17]=y((...t)=>l.changePassword&&l.changePassword(...t),["prevent"])),class:"space-y-6"},[e("div",null,[e("label",R,[n(r,{icon:"user",class:"mr-2"}),s[26]||(s[26]=a(" Current Username "))]),m(e("input",{"onUpdate:modelValue":s[8]||(s[8]=t=>o.passwordForm.oldUsername=t),type:"text",class:"form-input",required:"",autocomplete:"username"},null,512),[[k,o.passwordForm.oldUsername]])]),e("div",null,[e("label",j,[n(r,{icon:"lock",class:"mr-2"}),s[27]||(s[27]=a(" Current Password "))]),e("div",z,[m(e("input",{"onUpdate:modelValue":s[9]||(s[9]=t=>o.passwordForm.oldPassword=t),type:o.showCurrentPassword?"text":"password",class:"form-input pr-12",required:"",autocomplete:"current-password"},null,8,Y),[[c,o.passwordForm.oldPassword]]),e("button",{type:"button",onClick:s[10]||(s[10]=t=>o.showCurrentPassword=!o.showCurrentPassword),class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-muted hover:text-text-light"},[n(r,{icon:o.showCurrentPassword?"eye-slash":"eye"},null,8,["icon"])])])]),e("div",null,[e("label",G,[n(r,{icon:"user-edit",class:"mr-2"}),s[28]||(s[28]=a(" New Username "))]),m(e("input",{"onUpdate:modelValue":s[11]||(s[11]=t=>o.passwordForm.newUsername=t),type:"text",class:"form-input",required:"",autocomplete:"username"},null,512),[[k,o.passwordForm.newUsername]])]),e("div",null,[e("label",J,[n(r,{icon:"key",class:"mr-2"}),s[29]||(s[29]=a(" New Password "))]),e("div",K,[m(e("input",{"onUpdate:modelValue":s[12]||(s[12]=t=>o.passwordForm.newPassword=t),type:o.showNewPassword?"text":"password",class:"form-input pr-12",required:"",autocomplete:"new-password",minlength:"4"},null,8,O),[[c,o.passwordForm.newPassword]]),e("button",{type:"button",onClick:s[13]||(s[13]=t=>o.showNewPassword=!o.showNewPassword),class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-muted hover:text-text-light"},[n(r,{icon:o.showNewPassword?"eye-slash":"eye"},null,8,["icon"])])]),s[30]||(s[30]=e("p",{class:"text-sm text-text-muted mt-1"},"Minimum 4 characters",-1))]),e("div",null,[e("label",Q,[n(r,{icon:"shield-alt",class:"mr-2"}),s[31]||(s[31]=a(" Confirm New Password "))]),e("div",W,[m(e("input",{"onUpdate:modelValue":s[14]||(s[14]=t=>o.confirmPassword=t),type:o.showConfirmPassword?"text":"password",class:"form-input pr-12",required:"",minlength:"4"},null,8,X),[[c,o.confirmPassword]]),e("button",{type:"button",onClick:s[15]||(s[15]=t=>o.showConfirmPassword=!o.showConfirmPassword),class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-muted hover:text-text-light"},[n(r,{icon:o.showConfirmPassword?"eye-slash":"eye"},null,8,["icon"])])]),o.confirmPassword&&!l.passwordsMatch?(d(),h("p",Z," Passwords do not match ")):x("",!0)]),e("div",$,[e("button",{type:"submit",disabled:o.passwordLoading||!l.isPasswordFormValid,class:"btn btn-primary disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[o.passwordLoading?(d(),u(r,{key:0,icon:"spinner",class:"animate-spin"})):(d(),u(r,{key:1,icon:"save"})),a(" "+p(o.passwordLoading?"Changing...":"Change Password"),1)],8,ss),s[33]||(s[33]=a()),e("button",{type:"button",onClick:s[16]||(s[16]=(...t)=>l.resetPasswordForm&&l.resetPasswordForm(...t)),class:"btn btn-primary flex items-center gap-2"},[n(r,{icon:"undo"}),s[32]||(s[32]=a(" Reset "))])])],32),e("div",es,[e("h3",os,[n(r,{icon:"info-circle",class:"text-secondary"}),s[34]||(s[34]=a(" Security Tips "))]),s[35]||(s[35]=a()),s[36]||(s[36]=e("ul",{class:"text-sm text-text-muted space-y-1"},[e("li",null,"• Use a strong, unique password"),e("li",null,"• Include a mix of letters, numbers, and symbols"),e("li",null,"• Avoid using personal information"),e("li",null,"• Your password is encrypted and cannot be recovered"),e("li",null,"• BASE_DIR changes are saved to a user-specific config file"),e("li",null,"• API tokens are stored securely and used for downloading models"),e("li",null,"• HuggingFace tokens allow access to gated models and private repositories"),e("li",null,"• CivitAI tokens are required for downloading some models from CivitAI")],-1))])]),_:1})])])}const as=P(_,[["render",ts]]);export{as as default};
