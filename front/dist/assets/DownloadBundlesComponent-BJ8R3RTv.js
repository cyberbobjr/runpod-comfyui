import{_ as ct,u as ut,a as xt,r as v,c as mt,o as ft,b as a,d as e,e as g,f as d,g as x,h as s,i as L,F as r,j as pt,k as C,l as P,t as u,w as Y,v as ht,m as gt,n as A,p as O,q as j,s as N,x as F,y as K,z as D,A as i,B as R,C as X,D as vt,E as yt,G as _t,H as bt,I as wt,J as kt}from"./index-DsIss_bJ.js";const Bt={class:"p-4 bg-background space-y-6"},Ct={class:"card"},Dt={class:"text-lg font-semibold text-text-light mb-4 flex items-center"},It={class:"flex items-center space-x-4"},$t=["disabled"],Ut={key:0,class:"text-text-muted flex items-center"},jt={class:"text-text-muted mt-2 text-sm flex items-center"},Nt={class:"card"},Ft={class:"flex justify-between items-center mb-4"},Mt={class:"text-xl font-semibold text-text-light flex items-center"},St={class:"flex items-center space-x-4"},Pt={class:"text-sm text-text-muted"},At={class:"relative"},Ot={class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-text-light-muted"},Tt={class:"mb-6"},Et={class:"text-text-muted mb-4 flex items-center"},Vt={class:"relative min-h-[200px]"},Lt={key:0,class:"absolute inset-0 flex items-center justify-center bg-background-soft bg-opacity-75 z-10"},zt={key:1,class:"overflow-x-auto"},qt={class:"min-w-full divide-y divide-border"},Ht={class:"bg-background-mute"},Jt={class:"px-4 py-3 text-left text-xs font-medium text-text-light uppercase tracking-wider"},Wt={class:"px-4 py-3 text-left text-xs font-medium text-text-light uppercase tracking-wider"},Gt={class:"px-4 py-3 text-left text-xs font-medium text-text-light uppercase tracking-wider"},Qt={class:"px-4 py-3 text-left text-xs font-medium text-text-light uppercase tracking-wider"},Yt={class:"bg-background-soft divide-y divide-border"},Kt={class:"px-4 py-3"},Rt={class:"flex items-center"},Xt={class:"text-text-light font-medium"},Zt={key:0,class:"text-xs text-text-muted"},te={key:1,class:"text-xs text-text-muted"},ee={class:"px-4 py-3 text-text-light max-w-xs"},se=["title"],le={class:"px-4 py-3"},ne={class:"flex flex-wrap gap-1"},oe={class:"px-4 py-3"},ae={class:"flex items-center space-x-2"},ie={class:"text-xs text-text-muted"},de={class:"mt-1"},re={class:"px-4 py-3"},ce={class:"flex space-x-2"},ue=["onClick"],xe=["onClick"],me=["onClick","disabled"],fe=["onClick","disabled"],pe={key:2,class:"text-center py-10"},he={class:"flex flex-col items-center"},ge={class:"text-text-muted mt-1"},ve=["disabled"],ye={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},_e={class:"bg-background rounded-lg shadow-xl max-w-4xl w-full max-h-[80vh] overflow-hidden mx-4"},be={class:"flex justify-between items-center p-4 border-b border-border"},we={class:"text-lg font-semibold text-text-light"},ke={key:0,class:"p-6 overflow-y-auto max-h-[70vh]"},Be={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Ce={class:"font-medium text-text-light mb-2 flex items-center"},De={class:"space-y-2"},Ie={class:"text-text-light"},$e={class:"text-text-light"},Ue={class:"text-text-light"},je={key:0},Ne={class:"text-text-light"},Fe=["href"],Me={class:"font-medium text-text-light mb-2 flex items-center"},Se={class:"text-text-light"},Pe={class:"mb-6"},Ae={class:"font-medium text-text-light mb-3 flex items-center"},Oe={key:0,class:"flex flex-wrap gap-2"},Te={key:1,class:"text-text-muted"},Ee={class:"font-medium text-text-light mb-3 flex items-center"},Ve={key:0,class:"space-y-2"},Le=["onClick"],ze={class:"flex items-center"},qe={class:"font-medium text-text-light"},He={class:"ml-2 text-sm text-text-muted"},Je={class:"px-4 pb-4 bg-background-soft"},We={key:0,class:"text-text-muted mb-3 mt-2"},Ge={key:1},Qe={class:"grid grid-cols-1 gap-2 max-h-60 overflow-y-auto"},Ye={class:"flex-1 min-w-0"},Ke={class:"flex items-center"},Re={class:"font-medium text-text-light truncate mr-3"},Xe={key:0,class:"inline-flex items-center px-2 py-1 rounded text-xs bg-green-800 text-white",title:"Model is installed on disk"},Ze={key:1,class:"inline-flex items-center px-2 py-1 rounded text-xs bg-gray-600 text-white",title:"Model is not installed on disk"},ts={class:"text-xs text-text-muted mt-1"},es={class:"inline-flex items-center mr-3"},ss={key:0,class:"inline-flex items-center"},ls={key:2,class:"text-text-muted text-sm"},ns={key:1,class:"text-text-muted"},os={__name:"DownloadBundlesComponent",setup(as){const{success:M,error:y,confirm:z}=ut(),{startInstallation:Z}=xt(),w=v(""),p=v(!1),I=v([]),q=v([]),H=v({}),T=v(!1),m=v(null),k=v(new Set),E=async()=>{var l,t;try{const n=await D.get("/bundles/");I.value=n.data||[]}catch(n){y("Failed to load uploaded bundles: "+(((t=(l=n.response)==null?void 0:l.data)==null?void 0:t.message)||n.message))}},S=async()=>{var l,t;try{const n=await D.get("/bundles/installed/");q.value=n.data||[]}catch(n){y("Failed to load installed bundles: "+(((t=(l=n.response)==null?void 0:l.data)==null?void 0:t.message)||n.message))}},tt=async()=>{var l,t;try{const n=await D.get("/models/");H.value=n.data||{}}catch(n){y("Failed to load models data: "+(((t=(l=n.response)==null?void 0:l.data)==null?void 0:t.message)||n.message))}},J=l=>{const t=H.value.groups||{};for(const n in t){const c=t[n];for(const f of c)if(f.dest===l.dest&&l.dest||f.url===l.url&&l.url)return f.exists||!1}return!1},_=l=>{if(!l.hardware_profiles)return{status:"no-models",text:"No Models",count:"0/0"};let t=0,n=0;return Object.values(l.hardware_profiles).forEach(c=>{c.models&&c.models.forEach(f=>{t++,J(f)&&n++})}),t===0?{status:"no-models",text:"No Models",count:"0/0"}:n===0?{status:"not-installed",text:"Not Installed",count:`0/${t}`}:n===t?{status:"fully-installed",text:"Fully Installed",count:`${n}/${t}`}:{status:"partially-installed",text:"Partial",count:`${n}/${t}`}},V=(l,t=null)=>q.value.some(n=>n.id===l&&(!t||n.profile===t)),et=async l=>{var t,n;p.value=!0;try{const c=new FormData;c.append("bundle_file",l),await D.post("/bundles/upload/",c,{headers:{"Content-Type":"multipart/form-data"}}),M(`Bundle "${l.name}" uploaded successfully`),await E()}catch(c){y("Failed to upload bundle: "+(((n=(t=c.response)==null?void 0:t.data)==null?void 0:n.detail)||c.message))}finally{p.value=!1}},st=async l=>{const t=l.target.files[0];t&&(await et(t),l.target.value="")},W=()=>{document.getElementById("bundle-upload-file").click()},B=l=>{const t=Object.keys(l.hardware_profiles||{}),n=t.filter(c=>V(l.id,c));return n.length===0?{status:"not-installed",text:"Not Installed"}:n.length===t.length?{status:"fully-installed",text:"Fully Installed"}:{status:"partially-installed",text:`Partially Installed (${n.length}/${t.length})`}},lt=async l=>{var t,n;try{const c=Object.keys(l.hardware_profiles||{});if(c.length===0)throw new Error("No hardware profile available for this bundle");const f=c.filter(o=>!V(l.id,o));if(f.length===0){M(`Bundle "${l.name}" is already fully installed`);return}await Z(l.id,l.name,f),setTimeout(async()=>{await S()},2e3)}catch(c){y("Failed to start installation: "+(((n=(t=c.response)==null?void 0:t.data)==null?void 0:n.detail)||c.message))}},nt=async l=>{var t,n;try{if(await z(`Are you sure you want to uninstall bundle "${l.name}"?`,"Confirm Uninstall")){p.value=!0;const f=Object.keys(l.hardware_profiles||{});for(const o of f)V(l.id,o)&&await D.post("/bundles/uninstall",{bundle_id:l.id,profile:o});M(`Bundle "${l.name}" uninstalled successfully`),await S()}}catch(c){y("Failed to uninstall bundle: "+(((n=(t=c.response)==null?void 0:t.data)==null?void 0:n.detail)||c.message))}finally{p.value=!1}},ot=async l=>{var t,n;try{await z(`Are you sure you want to delete the uploaded bundle "${l.name}"? This will remove it from the server permanently.`,"Confirm Delete")&&(p.value=!0,await D.delete(`/bundles/${l.id}`),M(`Bundle "${l.name}" deleted successfully`),await E(),await S())}catch(c){y("Failed to delete bundle: "+(((n=(t=c.response)==null?void 0:t.data)==null?void 0:n.detail)||c.message))}finally{p.value=!1}},at=l=>{m.value=l,T.value=!0},it=l=>{k.value.has(l)?k.value.delete(l):k.value.add(l)},G=()=>{T.value=!1,m.value=null,k.value.clear()},dt=l=>l.dest?l.dest.split("/").pop():l.url?l.url.split("/").pop():"Unknown model",Q=mt(()=>{if(!w.value)return I.value;const l=w.value.toLowerCase();return I.value.filter(t=>t.name.toLowerCase().includes(l)||t.description.toLowerCase().includes(l)||t.workflows&&t.workflows.some(n=>n.toLowerCase().includes(l)))});return ft(async()=>{await Promise.all([E(),S(),tt()])}),(l,t)=>{var n,c,f;return i(),a("div",Bt,[e("div",Ct,[e("h3",Dt,[d(s(r),{icon:s(L),class:"mr-2"},null,8,["icon"]),t[1]||(t[1]=x(" Upload Bundle "))]),e("div",It,[e("input",{type:"file",class:"hidden",id:"bundle-upload-file",onChange:st,accept:".json"},null,32),e("button",{class:"btn btn-primary",onClick:W,disabled:p.value},[d(s(r),{icon:s(L),class:"mr-1"},null,8,["icon"]),t[2]||(t[2]=x("Upload Bundle File "))],8,$t),p.value?(i(),a("div",Ut,[d(s(r),{icon:s(pt),class:"animate-spin mr-1"},null,8,["icon"]),t[3]||(t[3]=x(" Processing... "))])):g("",!0)]),e("p",jt,[d(s(r),{icon:s(C),class:"mr-1"},null,8,["icon"]),t[4]||(t[4]=x(" Upload a JSON bundle file to add it to your collection. You can then install or manage it below. "))])]),e("div",Nt,[e("div",Ft,[e("h2",Mt,[d(s(r),{icon:s(P),class:"mr-2"},null,8,["icon"]),t[5]||(t[5]=x(" Uploaded Bundles "))]),e("div",St,[e("div",Pt,u(I.value.length)+" bundle"+u(I.value.length!==1?"s":"")+" uploaded ",1),e("div",At,[Y(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>w.value=o),type:"text",placeholder:"Search bundles",class:"form-input pl-10"},null,512),[[ht,w.value]]),e("span",Ot,[d(s(r),{icon:s(gt)},null,8,["icon"])])])])]),e("div",Tt,[e("p",Et,[d(s(r),{icon:s(C),class:"mr-2"},null,8,["icon"]),t[6]||(t[6]=x(" Manage your uploaded bundles: view details, install/uninstall, or delete them. "))]),e("div",Vt,[p.value?(i(),a("div",Lt,t[7]||(t[7]=[e("div",{class:"flex flex-col items-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"}),e("span",{class:"mt-2 text-text-light"},"Processing...")],-1)]))):g("",!0),Q.value.length>0?(i(),a("div",zt,[e("table",qt,[e("thead",Ht,[e("tr",null,[e("th",Jt,[d(s(r),{icon:s(P),class:"mr-1"},null,8,["icon"]),t[8]||(t[8]=x("Name "))]),e("th",Wt,[d(s(r),{icon:s(C),class:"mr-1"},null,8,["icon"]),t[9]||(t[9]=x("Description "))]),e("th",Gt,[d(s(r),{icon:s(A),class:"mr-1"},null,8,["icon"]),t[10]||(t[10]=x("Profiles "))]),e("th",Qt,[d(s(r),{icon:s(O),class:"mr-1"},null,8,["icon"]),t[11]||(t[11]=x("Installation Status "))]),t[12]||(t[12]=e("th",{class:"px-4 py-3 text-left text-xs font-medium text-text-light uppercase tracking-wider"}," Actions ",-1))])]),e("tbody",Yt,[(i(!0),a(j,null,N(Q.value,o=>(i(),a("tr",{key:o.id,class:"hover:bg-background-mute"},[e("td",Kt,[e("div",Rt,[d(s(r),{icon:s(P),class:"mr-2 text-primary"},null,8,["icon"]),e("div",null,[e("span",Xt,u(o.name),1),o.author?(i(),a("div",Zt,"by "+u(o.author),1)):g("",!0),o.version?(i(),a("div",te,"v"+u(o.version),1)):g("",!0)])])]),e("td",ee,[e("div",{class:"truncate",title:o.description},u(o.description),9,se)]),e("td",le,[e("div",ne,[(i(!0),a(j,null,N(o.hardware_profiles||{},(h,$)=>{var U;return i(),a("span",{key:$,class:"inline-flex items-center px-2 py-1 rounded text-xs bg-gray-600 text-white"},[d(s(r),{icon:s(A),class:"mr-1"},null,8,["icon"]),x(" "+u($)+" ("+u(((U=h.models)==null?void 0:U.length)||0)+" models) ",1)])}),128))])]),e("td",oe,[e("div",ae,[e("span",{class:R(["px-2 py-1 inline-flex text-xs rounded items-center",_(o).status==="fully-installed"?"bg-green-800 text-white":_(o).status==="partially-installed"?"bg-yellow-700 text-white":_(o).status==="not-installed"?"bg-gray-700 text-white":"bg-gray-600 text-white"])},[d(s(r),{icon:_(o).status==="fully-installed"?s(O):_(o).status==="partially-installed"?s(X):s(F),class:"mr-1"},null,8,["icon"]),x(" "+u(_(o).text),1)],2),e("span",ie,u(_(o).count)+" models ",1)]),e("div",de,[e("span",{class:R(["px-2 py-1 inline-flex text-xs rounded items-center",B(o).status==="fully-installed"?"bg-blue-800 text-white":B(o).status==="partially-installed"?"bg-blue-600 text-white":"bg-gray-600 text-white"])},[d(s(r),{icon:B(o).status==="fully-installed"?s(O):B(o).status==="partially-installed"?s(X):s(F),class:"mr-1"},null,8,["icon"]),x(" Bundle: "+u(B(o).text),1)],2)])]),e("td",re,[e("div",ce,[e("button",{onClick:h=>at(o),class:"btn btn-sm btn-outline",title:"View bundle details"},[d(s(r),{icon:s(C),class:"mr-1"},null,8,["icon"]),t[13]||(t[13]=x(" Details "))],8,ue),B(o).status==="not-installed"?(i(),a("button",{key:0,onClick:h=>lt(o),class:"btn btn-sm btn-primary"},[d(s(r),{icon:s(vt),class:"mr-1"},null,8,["icon"]),t[14]||(t[14]=x(" Install "))],8,xe)):(i(),a("button",{key:1,onClick:h=>nt(o),class:"btn btn-sm bg-yellow-600 hover:bg-yellow-700 text-white",disabled:p.value},[d(s(r),{icon:s(F),class:"mr-1"},null,8,["icon"]),t[15]||(t[15]=x(" Uninstall "))],8,me)),e("button",{onClick:h=>ot(o),class:"btn btn-sm bg-red-600 hover:bg-red-700 text-white",disabled:p.value,title:"Delete bundle permanently"},[d(s(r),{icon:s(yt),class:"mr-1"},null,8,["icon"]),t[16]||(t[16]=x(" Delete "))],8,fe)])])]))),128))])])])):(i(),a("div",pe,[e("div",he,[d(s(r),{icon:s(P),class:"text-4xl text-gray-500 mb-4"},null,8,["icon"]),t[18]||(t[18]=e("h3",{class:"text-lg font-semibold text-text-light"},"No uploaded bundles",-1)),e("p",ge,u(w.value?"No bundles match your search criteria.":"Upload your first bundle using the form above."),1),w.value?g("",!0):(i(),a("button",{key:0,class:"btn btn-primary mt-4",onClick:W,disabled:p.value},[d(s(r),{icon:s(L),class:"mr-1"},null,8,["icon"]),t[17]||(t[17]=x("Upload Bundle "))],8,ve))])]))])])]),T.value?(i(),a("div",ye,[e("div",_e,[e("div",be,[e("h3",we,"Bundle Details: "+u((n=m.value)==null?void 0:n.name),1),e("button",{type:"button",class:"text-text-muted hover:text-text-light",onClick:G},[d(s(r),{icon:s(F),class:"text-xl"},null,8,["icon"])])]),m.value?(i(),a("div",ke,[e("div",Be,[e("div",null,[e("h4",Ce,[d(s(r),{icon:s(C),class:"mr-2"},null,8,["icon"]),t[19]||(t[19]=x("Basic Information "))]),e("dl",De,[e("div",null,[t[20]||(t[20]=e("dt",{class:"text-sm text-text-muted"},"Name:",-1)),e("dd",Ie,u(m.value.name),1)]),e("div",null,[t[21]||(t[21]=e("dt",{class:"text-sm text-text-muted"},"Version:",-1)),e("dd",$e,u(m.value.version||"1.0.0"),1)]),e("div",null,[t[22]||(t[22]=e("dt",{class:"text-sm text-text-muted"},"Author:",-1)),e("dd",Ue,u(m.value.author||"N/A"),1)]),m.value.website?(i(),a("div",je,[t[23]||(t[23]=e("dt",{class:"text-sm text-text-muted"},"Website:",-1)),e("dd",Ne,[e("a",{href:m.value.website,target:"_blank",class:"text-primary hover:underline"},u(m.value.website),9,Fe)])])):g("",!0)])]),e("div",null,[e("h4",Me,[d(s(r),{icon:s(C),class:"mr-2"},null,8,["icon"]),t[24]||(t[24]=x("Description "))]),e("p",Se,u(m.value.description),1)])]),e("div",Pe,[e("h4",Ae,[d(s(r),{icon:s(K),class:"mr-2"},null,8,["icon"]),x("Workflows ("+u(((c=m.value.workflows)==null?void 0:c.length)||0)+") ",1)]),((f=m.value.workflows)==null?void 0:f.length)>0?(i(),a("div",Oe,[(i(!0),a(j,null,N(m.value.workflows,o=>(i(),a("span",{key:o,class:"inline-flex items-center px-3 py-1 rounded text-sm bg-blue-600 text-white"},[d(s(r),{icon:s(K),class:"mr-1"},null,8,["icon"]),x(u(o),1)]))),128))])):(i(),a("p",Te,"No workflows defined."))]),e("div",null,[e("h4",Ee,[d(s(r),{icon:s(A),class:"mr-2"},null,8,["icon"]),x("Hardware Profiles ("+u(Object.keys(m.value.hardware_profiles||{}).length)+") ",1)]),Object.keys(m.value.hardware_profiles||{}).length>0?(i(),a("div",Ve,[(i(!0),a(j,null,N(m.value.hardware_profiles,(o,h)=>{var $,U;return i(),a("div",{key:h,class:"border border-border rounded-lg overflow-hidden"},[e("button",{onClick:b=>it(h),class:"w-full px-4 py-3 bg-background-mute hover:bg-background-soft transition-colors duration-200 flex items-center justify-between text-left"},[e("div",ze,[d(s(r),{icon:s(A),class:"mr-2 text-primary"},null,8,["icon"]),e("span",qe,u(h),1),e("span",He,"("+u((($=o.models)==null?void 0:$.length)||0)+" models)",1)]),d(s(r),{icon:k.value.has(h)?s(_t):s(bt),class:"text-text-muted transition-transform duration-200"},null,8,["icon"])],8,Le),Y(e("div",Je,[o.description?(i(),a("p",We,u(o.description),1)):g("",!0),((U=o.models)==null?void 0:U.length)>0?(i(),a("div",Ge,[t[27]||(t[27]=e("h6",{class:"text-sm font-medium text-text-light mb-2"},"Models:",-1)),e("div",Qe,[(i(!0),a(j,null,N(o.models,(b,rt)=>(i(),a("div",{key:rt,class:"flex items-center justify-between p-3 bg-background rounded border text-sm"},[e("div",Ye,[e("div",Ke,[e("div",Re,u(dt(b)),1),J(b)?(i(),a("span",Xe,[d(s(r),{icon:s(O),class:"mr-1"},null,8,["icon"]),t[25]||(t[25]=x(" Installed "))])):(i(),a("span",Ze,[d(s(r),{icon:s(F),class:"mr-1"},null,8,["icon"]),t[26]||(t[26]=x(" Not Installed "))]))]),e("div",ts,[e("span",es,[d(s(r),{icon:s(kt),class:"mr-1"},null,8,["icon"]),x(u(b.type),1)]),b.tags&&b.tags.length>0?(i(),a("span",ss," Tags: "+u(b.tags.join(", ")),1)):g("",!0)])])]))),128))])])):(i(),a("div",ls,"No models in this profile."))],512),[[wt,k.value.has(h)]])])}),128))])):(i(),a("p",ns,"No hardware profiles defined."))])])):g("",!0),e("div",{class:"flex justify-end space-x-3 p-4 border-t border-border bg-background-mute"},[e("button",{type:"button",class:"btn btn-secondary",onClick:G}," Close ")])])])):g("",!0)])}}},ds=ct(os,[["__scopeId","data-v-a703a8f1"]]);export{ds as default};
