import{d as G,R as J,r,c as I,o as K,W as O,b as T,e as c,f as s,h as N,j as o,n as Q,t as C,w as V,X as D,z as m,i,A as S,g as v,a2 as U,M as A}from"./index-jy5-nOjD.js";import{A as B}from"./AccordionComponent-Eg9b-t0g.js";const Z={class:"space-y-6 p-4 bg-background"},ee={class:"card"},se={class:"flex items-center gap-3 mb-6"},te={class:"form-label"},oe={class:"text-sm text-text-muted mt-1"},ae=["disabled"],le={class:"form-label"},ne={class:"relative"},re=["type"],ie={class:"form-label"},ue={class:"relative"},de=["type"],ce={class:"flex gap-4"},me=["disabled"],pe={class:"form-label"},ve={class:"form-label"},fe={class:"relative"},ge=["type"],be={class:"form-label"},ye={class:"form-label"},we={class:"relative"},xe=["type"],ke={class:"form-label"},_e={class:"relative"},he=["type"],Pe={key:0,class:"text-sm text-red-400 mt-1"},Ce={class:"flex gap-4"},Ue=["disabled"],Ae={class:"mt-8 p-4 bg-background-mute rounded-lg"},Ie={class:"font-semibold text-text-light mb-2 flex items-center gap-2"},De=G({__name:"SettingsComponent",setup(Fe){const H=J(),f=r({base_dir:""}),E=r(""),g=r(!1),u=r({hf_token:"",civitai_token:""}),b=r(!1),y=r(!1),w=r(!1),n=r({oldUsername:"",oldPassword:"",newUsername:"",newPassword:""}),x=r(""),k=r(!1),p=r(""),F=r("info"),_=r(!1),h=r(!1),P=r(!1),R=I(()=>n.value.newPassword===x.value),q=I(()=>!!n.value.oldUsername.trim()&&!!n.value.oldPassword&&!!n.value.newUsername.trim()&&n.value.newPassword.length>=4&&!!R.value),j=I(()=>{const l="border-l-4";switch(F.value){case"success":return`${l} border-green-500 bg-green-900/20 text-green-300`;case"error":return`${l} border-red-500 bg-red-900/20 text-red-300`;case"warning":return`${l} border-yellow-500 bg-yellow-900/20 text-yellow-300`;default:return`${l} border-secondary bg-blue-900/20 text-secondary`}}),L=I(()=>{switch(F.value){case"success":return"check-circle";case"error":return"exclamation-circle";case"warning":return"exclamation-triangle";default:return"info-circle"}}),$=async()=>{try{const l=await A.get("/jsonmodels/config");f.value.base_dir=l.data.BASE_DIR,E.value=l.data.source;const e=await A.get("/models/tokens");u.value.hf_token=e.data.hf_token||"",u.value.civitai_token=e.data.civitai_token||""}catch(l){console.error("Error loading config:",l),d("Failed to load configuration.","error")}},z=async()=>{if(f.value.base_dir.trim()){g.value=!0,p.value="";try{await A.post("/jsonmodels/config",{base_dir:f.value.base_dir}),d("Base directory updated successfully!","success"),await $()}catch(l){console.error("Error updating base directory:",l),d("Failed to update base directory. Please try again.","error")}finally{g.value=!1}}},W=async()=>{b.value=!0,p.value="";try{await A.post("/models/tokens",{hf_token:u.value.hf_token||null,civitai_token:u.value.civitai_token||null}),d("API tokens updated successfully!","success")}catch(l){console.error("Error updating tokens:",l),d("Failed to update API tokens. Please try again.","error")}finally{b.value=!1}},X=()=>{u.value={hf_token:"",civitai_token:""},y.value=!1,w.value=!1},Y=async()=>{var l,e;if(q.value){k.value=!0,p.value="";try{await A.post("/models/change_user",{old_username:n.value.oldUsername,old_password:n.value.oldPassword,new_username:n.value.newUsername,new_password:n.value.newPassword}),d("Password changed successfully! Please log in again with your new credentials.","success"),M(),setTimeout(()=>{localStorage.removeItem("auth_token"),H.push({name:"login"})},2e3)}catch(t){console.error("Error changing password:",t),((l=t.response)==null?void 0:l.status)===401?d("Invalid current username or password.","error"):((e=t.response)==null?void 0:e.status)===409?d("Username already exists. Please choose a different username.","error"):d("Failed to change password. Please try again.","error")}finally{k.value=!1}}},M=()=>{n.value={oldUsername:"",oldPassword:"",newUsername:"",newPassword:""},x.value="",_.value=!1,h.value=!1,P.value=!1},d=(l,e="info")=>{p.value=l,F.value=e};return K(()=>{$()}),(l,e)=>{const t=O("FontAwesomeIcon");return c(),T("div",Z,[s("div",ee,[s("div",se,[o(t,{icon:"cog",class:"text-primary text-2xl"}),e[13]||(e[13]=s("h1",{class:"text-2xl font-bold text-heading"},"Settings",-1))]),p.value?(c(),T("div",{key:0,class:Q([j.value,"p-4 rounded-lg mb-6 flex items-center gap-2"])},[o(t,{icon:L.value},null,8,["icon"]),s("span",null,C(p.value),1)],2)):N("",!0),o(B,{title:"Base Directory Configuration",icon:"folder","default-open":!0,class:"mb-4"},{default:V(()=>[s("form",{onSubmit:D(z,["prevent"]),class:"space-y-4"},[s("div",null,[s("label",te,[o(t,{icon:"folder-open",class:"mr-2"}),e[14]||(e[14]=i(" BASE_DIR "))]),m(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>f.value.base_dir=a),type:"text",class:"form-input",placeholder:"Enter base directory path",required:""},null,512),[[S,f.value.base_dir]]),s("p",oe," Current source: "+C(E.value),1)]),s("button",{type:"submit",disabled:g.value,class:"btn btn-primary disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[g.value?(c(),v(t,{key:0,icon:"spinner",class:"animate-spin"})):(c(),v(t,{key:1,icon:"save"})),i(" "+C(g.value?"Updating...":"Update Base Directory"),1)],8,ae)],32)]),_:1}),o(B,{title:"API Tokens Configuration",icon:"key","default-open":!1,class:"mb-4"},{default:V(()=>[s("form",{onSubmit:D(W,["prevent"]),class:"space-y-4"},[s("div",null,[s("label",le,[o(t,{icon:"cloud",class:"mr-2"}),e[15]||(e[15]=i(" HuggingFace Token "))]),s("div",ne,[m(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.hf_token=a),type:y.value?"text":"password",class:"form-input pr-12",placeholder:"Enter your HuggingFace token (optional)"},null,8,re),[[U,u.value.hf_token]]),s("button",{type:"button",onClick:e[2]||(e[2]=a=>y.value=!y.value),class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-muted hover:text-text-light"},[o(t,{icon:y.value?"eye-slash":"eye"},null,8,["icon"])])]),e[16]||(e[16]=s("p",{class:"text-sm text-text-muted mt-1"}," Required for downloading models from HuggingFace ",-1))]),s("div",null,[s("label",ie,[o(t,{icon:"download",class:"mr-2"}),e[17]||(e[17]=i(" CivitAI Token "))]),s("div",ue,[m(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.civitai_token=a),type:w.value?"text":"password",class:"form-input pr-12",placeholder:"Enter your CivitAI token (optional)"},null,8,de),[[U,u.value.civitai_token]]),s("button",{type:"button",onClick:e[4]||(e[4]=a=>w.value=!w.value),class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-muted hover:text-text-light"},[o(t,{icon:w.value?"eye-slash":"eye"},null,8,["icon"])])]),e[18]||(e[18]=s("p",{class:"text-sm text-text-muted mt-1"}," Required for downloading models from CivitAI ",-1))]),s("div",ce,[s("button",{type:"submit",disabled:b.value,class:"btn btn-primary disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[b.value?(c(),v(t,{key:0,icon:"spinner",class:"animate-spin"})):(c(),v(t,{key:1,icon:"save"})),i(" "+C(b.value?"Updating...":"Update Tokens"),1)],8,me),s("button",{type:"button",onClick:X,class:"btn btn-primary flex items-center gap-2"},[o(t,{icon:"undo"}),e[19]||(e[19]=i(" Reset "))])])],32)]),_:1}),o(B,{title:"Change Password",icon:"key","default-open":!1,class:"mb-4"},{default:V(()=>[s("form",{onSubmit:D(Y,["prevent"]),class:"space-y-6"},[s("div",null,[s("label",pe,[o(t,{icon:"user",class:"mr-2"}),e[20]||(e[20]=i(" Current Username "))]),m(s("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.oldUsername=a),type:"text",class:"form-input",required:"",autocomplete:"username"},null,512),[[S,n.value.oldUsername]])]),s("div",null,[s("label",ve,[o(t,{icon:"lock",class:"mr-2"}),e[21]||(e[21]=i(" Current Password "))]),s("div",fe,[m(s("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.oldPassword=a),type:_.value?"text":"password",class:"form-input pr-12",required:"",autocomplete:"current-password"},null,8,ge),[[U,n.value.oldPassword]]),s("button",{type:"button",onClick:e[7]||(e[7]=a=>_.value=!_.value),class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-muted hover:text-text-light"},[o(t,{icon:_.value?"eye-slash":"eye"},null,8,["icon"])])])]),s("div",null,[s("label",be,[o(t,{icon:"user-edit",class:"mr-2"}),e[22]||(e[22]=i(" New Username "))]),m(s("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.newUsername=a),type:"text",class:"form-input",required:"",autocomplete:"username"},null,512),[[S,n.value.newUsername]])]),s("div",null,[s("label",ye,[o(t,{icon:"key",class:"mr-2"}),e[23]||(e[23]=i(" New Password "))]),s("div",we,[m(s("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>n.value.newPassword=a),type:h.value?"text":"password",class:"form-input pr-12",required:"",autocomplete:"new-password",minlength:"4"},null,8,xe),[[U,n.value.newPassword]]),s("button",{type:"button",onClick:e[10]||(e[10]=a=>h.value=!h.value),class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-muted hover:text-text-light"},[o(t,{icon:h.value?"eye-slash":"eye"},null,8,["icon"])])]),e[24]||(e[24]=s("p",{class:"text-sm text-text-muted mt-1"},"Minimum 4 characters",-1))]),s("div",null,[s("label",ke,[o(t,{icon:"shield-alt",class:"mr-2"}),e[25]||(e[25]=i(" Confirm New Password "))]),s("div",_e,[m(s("input",{"onUpdate:modelValue":e[11]||(e[11]=a=>x.value=a),type:P.value?"text":"password",class:"form-input pr-12",required:"",minlength:"4"},null,8,he),[[U,x.value]]),s("button",{type:"button",onClick:e[12]||(e[12]=a=>P.value=!P.value),class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-muted hover:text-text-light"},[o(t,{icon:P.value?"eye-slash":"eye"},null,8,["icon"])])]),x.value&&!R.value?(c(),T("p",Pe," Passwords do not match ")):N("",!0)]),s("div",Ce,[s("button",{type:"submit",disabled:k.value||!q.value,class:"btn btn-primary disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[k.value?(c(),v(t,{key:0,icon:"spinner",class:"animate-spin"})):(c(),v(t,{key:1,icon:"save"})),i(" "+C(k.value?"Changing...":"Change Password"),1)],8,Ue),s("button",{type:"button",onClick:M,class:"btn btn-primary flex items-center gap-2"},[o(t,{icon:"undo"}),e[26]||(e[26]=i(" Reset "))])])],32),s("div",Ae,[s("h3",Ie,[o(t,{icon:"info-circle",class:"text-secondary"}),e[27]||(e[27]=i(" Security Tips "))]),e[28]||(e[28]=s("ul",{class:"text-sm text-text-muted space-y-1"},[s("li",null,"• Use a strong, unique password"),s("li",null,"• Include a mix of letters, numbers, and symbols"),s("li",null,"• Avoid using personal information"),s("li",null,"• Your password is encrypted and cannot be recovered"),s("li",null,"• BASE_DIR changes are saved to a user-specific config file"),s("li",null," • API tokens are stored securely and used for downloading models "),s("li",null," • HuggingFace tokens allow access to gated models and private repositories "),s("li",null," • CivitAI tokens are required for downloading some models from CivitAI ")],-1))])]),_:1})])])}}});export{De as default};
