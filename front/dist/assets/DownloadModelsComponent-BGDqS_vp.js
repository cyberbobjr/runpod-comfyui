import{_ as de,r as x,u as ce,a as ue,H as P,c as b,o as ge,b as l,d as s,B as p,e as y,w as he,v as fe,q as T,s as S,g as K,t as g,z as B,A as r}from"./index-CcCzNoNR.js";const ve={class:"download-models-container w-full p-4 space-y-4"},xe={class:"models-card bg-background-soft border border-border rounded-lg shadow-md"},pe={class:"flex items-center justify-between p-4 border-b border-border"},ye={class:"header-actions flex gap-2"},be=["disabled"],we=["disabled"],_e={class:"p-4 space-y-4"},ke={class:"filter-section bg-background-mute border border-border rounded-lg p-4 space-y-3"},me={class:"flex items-center gap-2 mb-2"},Ce={class:"relative"},De={key:0,class:"space-y-2"},Ae={class:"flex flex-wrap gap-2"},Me=["onClick"],Te={key:0,class:"ml-1"},Se={key:1,class:"text-xs text-text-light-muted"},Be={key:0},je={key:1},Fe={key:0,class:"text-center text-text-light-muted py-8"},Le={key:1,class:"space-y-4"},$e=["onClick"],Ee={class:"font-medium text-text-light"},Oe={key:0,class:"table-responsive"},Ve={class:"overflow-x-auto"},Ie={class:"w-full text-sm"},Ne={class:"bg-background-mute"},ze={class:"p-2 text-left"},Ge=["checked","onChange","disabled"],He={class:"p-2"},Pe=["checked","onChange","disabled"],Ke={class:"p-2"},Ue={class:"p-2"},qe={key:0,class:"flex flex-wrap gap-1"},Re={key:1,class:"text-text-light-muted"},We={class:"p-2 text-text-light"},Ye={class:"p-2 text-text-light"},Je={class:"p-2"},Qe=["href"],Xe={key:1,class:"text-text-light-muted"},Ze={class:"p-2"},et={class:"p-2"},tt={class:"flex gap-2"},st=["onClick","disabled"],ot=["onClick","disabled"],at={name:"DownloadModelsComponent"},lt=Object.assign(at,{setup(rt){const w=x([]),U=x({}),d=x({}),j=x(!1),h=x(""),c=x([]),v=x({}),{showNotification:_,showDialog:A}=ce(),{startModelDownload:q,restoreActiveDownloads:R}=ue(),M=async()=>{j.value=!0;try{const{data:e}=await B.get("/models/"),t={};let a=[];for(const[n,o]of Object.entries(e.groups||{}))t[n]=o,a=a.concat(o.map(i=>({...i,group:n})));w.value=a,U.value=t,d.value={...d.value}}finally{j.value=!1}},F=async()=>{try{const{data:e}=await B.get("/models/downloads");v.value=e||{}}catch{v.value={}}};let L={};P(()=>{for(const e in L)if(!(e in v.value)||v.value[e]&&v.value[e].progress===100){M();break}L={...v.value}}),b(()=>Object.entries(v.value).map(([e,t])=>({entry:w.value.find(n=>(n.dest||n.git)===e)||{},progress:t.progress,status:t.status}))),x(!1);const C=x([]),W=e=>{const t=C.value.indexOf(e);t>-1?C.value.splice(t,1):C.value.push(e)},Y=(e,t)=>{const a=u(e);t?d.value[a]=!0:delete d.value[a],d.value={...d.value}},$=b(()=>{const e=new Set;return w.value.forEach(t=>{t.tags&&(Array.isArray(t.tags)?t.tags.forEach(a=>e.add(a)):e.add(t.tags))}),Array.from(e).sort()}),E=b(()=>{let e=w.value;if(h.value.trim()){const t=h.value.toLowerCase().trim();e=e.filter(a=>{const n=(D(a.dest)||a.git||"").toLowerCase(),o=a.tags?(Array.isArray(a.tags)?a.tags.join(" "):a.tags).toLowerCase():"";return n.includes(t)||o.includes(t)})}return c.value.length>0&&(e=e.filter(t=>{if(!t.tags)return!1;const a=Array.isArray(t.tags)?t.tags:[t.tags];return c.value.every(n=>a.some(o=>o.toLowerCase()===n.toLowerCase()))})),e}),O=b(()=>{const e={};return E.value.forEach(t=>{const a=t.group||"Other";e[a]||(e[a]=[]),e[a].push(t)}),e}),J=e=>{const t=c.value.indexOf(e);t>-1?c.value.splice(t,1):c.value.push(e)},Q=()=>{h.value="",c.value=[]},u=e=>e.url||e.git,D=e=>(e==null?void 0:e.split("/").pop())||"",X=e=>e?e>1e9?(e/1e9).toFixed(2)+" GB":e>1e6?(e/1e6).toFixed(2)+" MB":e>1e3?(e/1e3).toFixed(2)+" KB":e+" B":"-",Z=e=>{const t=e.tags;return t?Array.isArray(t)?t.includes("nsfw"):t==="nsfw":!1},f=e=>!!v.value[u(e)],ee=e=>e.filter(t=>!f(t)).every(t=>d.value[u(t)]),te=(e,t)=>{for(const a of e)f(a)||(d.value[u(a)]=t)},k=b(()=>w.value.filter(e=>d.value[u(e)]&&e.exists)),m=b(()=>w.value.filter(e=>d.value[u(e)]&&!e.exists&&!v.value[u(e)]));P(()=>{console.log("selectedToDelete:",k.value.map(e=>u(e))),console.log("selectedToDownload:",m.value.map(e=>u(e)))});const V=b(()=>k.value.length>0),I=b(()=>m.value.length>0);function N(e){for(const t of e)delete d.value[u(t)];d.value={...d.value}}const se=async()=>{if(!k.value.length)return;await A({title:"Delete selected models",message:`Are you sure you want to delete ${k.value.length} model(s)?`,type:"confirm",confirmText:"Delete",cancelText:"Cancel"})&&(await z(k.value),N(k.value))},oe=async()=>{if(!m.value.length)return;await A({title:"Download selected models",message:`Download ${m.value.length} model(s)?`,type:"confirm",confirmText:"Download",cancelText:"Cancel"})&&(await G(m.value),N(m.value))};async function z(e){try{const t=await B.post("/models/delete",e);let n=(Array.isArray(t.data)?t.data:[t.data]).filter(o=>!o.ok);n.length?n.forEach(o=>_(o.msg||"Delete failed","error")):_(Array.isArray(e)&&e.length>1?"Selected models deleted":"Model deleted","success"),await M()}catch{_("Delete operation failed","error")}}async function G(e){try{const t=Array.isArray(e)?e:[e];for(const i of t){const ne=D(i.dest)||i.git||"Unknown model",ie=u(i);await q(ie,ne)}const a=await B.post("/models/download",e);let o=(Array.isArray(a.data)?a.data:[a.data]).filter(i=>!i.ok);o.length?o.forEach(i=>_(i.msg||"Download failed","error")):_(Array.isArray(e)&&e.length>1?"Selected models downloading":"Download started","success"),await M()}catch{_("Download operation failed","error")}}const ae=async e=>{await A({title:"Download model",message:`Download model "${D(e.dest)||e.git}"?`,type:"confirm",confirmText:"Download",cancelText:"Cancel"})&&await G(e)},le=async e=>{await A({title:"Delete model",message:`Delete model "${D(e.dest)||e.git}"?`,type:"confirm",confirmText:"Delete",cancelText:"Cancel"})&&await z(e)};let H=null;const re=()=>{clearInterval(H),H=setInterval(()=>{F()},5e3)};return ge(async()=>{await M(),await F(),await R(),re()}),(e,t)=>(r(),l("div",ve,[s("div",xe,[s("div",pe,[t[1]||(t[1]=s("div",{class:"flex items-center gap-2"},[s("svg",{class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"})]),s("span",{class:"text-lg font-bold text-white"},"Model Manager")],-1)),s("div",ye,[s("button",{disabled:!V.value,onClick:se,class:p(["px-4 py-2 rounded text-sm font-medium transition-colors",V.value?"bg-red-600 hover:bg-red-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"])},"Delete selected",10,be),s("button",{disabled:!I.value,onClick:oe,class:p(["px-4 py-2 rounded text-sm font-medium transition-colors",I.value?"bg-primary hover:bg-primary-dark text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"])},"Download selected",10,we)])]),s("div",_e,[s("div",ke,[s("div",me,[t[2]||(t[2]=s("svg",{class:"w-5 h-5 text-text-light",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.414A1 1 0 013 6.707V4z"})],-1)),t[3]||(t[3]=s("span",{class:"font-medium text-text-light"},"Filters",-1)),h.value||c.value.length>0?(r(),l("button",{key:0,onClick:Q,class:"ml-auto px-2 py-1 text-xs bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors"}," Clear All ")):y("",!0)]),s("div",Ce,[he(s("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>h.value=a),type:"text",placeholder:"Search by name or tags...",class:"w-full px-3 py-2 pl-10 bg-background border border-border rounded-md text-text-light placeholder-text-light-muted focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[fe,h.value]]),t[4]||(t[4]=s("svg",{class:"absolute left-3 top-2.5 w-4 h-4 text-text-light-muted",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),$.value.length>0?(r(),l("div",De,[t[5]||(t[5]=s("span",{class:"text-sm font-medium text-text-light"},"Filter by tags:",-1)),s("div",Ae,[(r(!0),l(T,null,S($.value,a=>(r(),l("button",{key:a,onClick:n=>J(a),class:p(["px-3 py-1 text-xs rounded-full border transition-colors",c.value.includes(a)?"bg-primary text-white border-primary":"bg-background border-border text-text-light hover:bg-background-mute"])},[K(g(a)+" ",1),c.value.includes(a)?(r(),l("span",Te,"Ã—")):y("",!0)],10,Me))),128))])])):y("",!0),h.value||c.value.length>0?(r(),l("div",Se,[K(" Showing "+g(E.value.length)+" of "+g(w.value.length)+" models ",1),h.value?(r(),l("span",Be,' matching "'+g(h.value)+'"',1)):y("",!0),c.value.length>0?(r(),l("span",je," with tags: "+g(c.value.join(", ")),1)):y("",!0)])):y("",!0)]),Object.keys(O.value).length===0?(r(),l("div",Fe,g(h.value||c.value.length>0?"No models match the current filters.":"No models found."),1)):(r(),l("div",Le,[(r(!0),l(T,null,S(O.value,(a,n)=>(r(),l("div",{key:n,class:"border border-border rounded-lg"},[s("button",{onClick:o=>W(n),class:"w-full flex items-center justify-between p-3 text-left hover:bg-background-mute transition-colors border-b border-border"},[s("span",Ee,g(n),1),(r(),l("svg",{class:p(["w-5 h-5 transition-transform",C.value.includes(n)?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[6]||(t[6]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))],8,$e),C.value.includes(n)?(r(),l("div",Oe,[s("div",Ve,[s("table",Ie,[s("thead",Ne,[s("tr",null,[s("th",ze,[s("input",{type:"checkbox",checked:ee(a),onChange:o=>te(a,o.target.checked),disabled:a.every(o=>f(o)),class:"rounded"},null,40,Ge)]),t[7]||(t[7]=s("th",{class:"p-2 text-left text-text-light"},"Name",-1)),t[8]||(t[8]=s("th",{class:"p-2 text-left text-text-light"},"Tags",-1)),t[9]||(t[9]=s("th",{class:"p-2 text-left text-text-light"},"Type",-1)),t[10]||(t[10]=s("th",{class:"p-2 text-left text-text-light"},"Size",-1)),t[11]||(t[11]=s("th",{class:"p-2 text-left text-text-light"},"Source",-1)),t[12]||(t[12]=s("th",{class:"p-2 text-left text-text-light"},"Present",-1)),t[13]||(t[13]=s("th",{class:"p-2 text-left text-text-light"},"Action",-1))])]),s("tbody",null,[(r(!0),l(T,null,S(a,o=>(r(),l("tr",{key:u(o),class:p(["border-b border-border hover:bg-background-mute transition-colors",f(o)?"is-downloading":""])},[s("td",He,[s("input",{type:"checkbox",checked:d.value[u(o)]||!1,onChange:i=>Y(o,i.target.checked),disabled:f(o),class:"rounded"},null,40,Pe)]),s("td",Ke,[s("span",{class:p(["font-medium",f(o)?"opacity-50":"",Z(o)?"text-red-400":"text-text-light"])},g(D(o.dest)||o.git),3)]),s("td",Ue,[o.tags&&o.tags.length?(r(),l("div",qe,[(r(!0),l(T,null,S(Array.isArray(o.tags)?o.tags:[o.tags],i=>(r(),l("span",{key:i,class:"px-2 py-1 bg-blue-600 text-white text-xs rounded"},g(i),1))),128))])):(r(),l("span",Re,"-"))]),s("td",We,g(o.type||n),1),s("td",Ye,g(o.size?X(o.size):"-"),1),s("td",Je,[o.src?(r(),l("a",{key:0,href:o.src,target:"_blank",rel:"noopener",class:"text-primary hover:text-primary-light underline"}," Link ",8,Qe)):(r(),l("span",Xe,"-"))]),s("td",Ze,[s("span",{class:p(["px-2 py-1 text-xs rounded",o.exists?"bg-green-600 text-white":"bg-red-600 text-white"])},g(o.exists?"Yes":"No"),3)]),s("td",et,[s("div",tt,[o.exists?y("",!0):(r(),l("button",{key:0,onClick:i=>ae(o),disabled:f(o),class:p(["px-3 py-1 rounded text-sm transition-colors",f(o)?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-primary hover:bg-primary-dark text-white"])}," Download ",10,st)),o.exists?(r(),l("button",{key:1,onClick:i=>le(o),disabled:f(o),class:p(["px-3 py-1 rounded text-sm transition-colors",f(o)?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700 text-white"])}," Delete ",10,ot)):y("",!0)])])],2))),128))])])])])):y("",!0)]))),128))]))])])]))}}),it=de(lt,[["__scopeId","data-v-6af35c54"]]);export{it as default};
